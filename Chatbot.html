<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§â‡§®‡•ç‡§®‡§§ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§ö‡•à‡§ü‡§¨‡•â‡§ü (TensorFlow.js)</title>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #3e8e41;
            --user-message-bg: #e3f2fd;
            --bot-message-bg: #ffffff;
            --dark-mode-bg: #121212;
            --dark-mode-text: #e0e0e0;
            --dark-mode-card: #1e1e1e;
        }
        
        body {
            font-family: 'Arial', 'Noto Sans Devanagari', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            background-color: #f5f5f5;
            transition: background-color 0.3s;
        }
        
        body.dark-mode {
            background-color: var(--dark-mode-bg);
            color: var(--dark-mode-text);
        }
        
        .chat-container {
            width: 100%;
            max-width: 600px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: background-color 0.3s;
        }
        
        .dark-mode .chat-container {
            background-color: var(--dark-mode-card);
        }
        
        .chat-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.2em;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .chat-box {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background-color: #f9f9f9;
            transition: background-color 0.3s;
        }
        
        .dark-mode .chat-box {
            background-color: #1a1a1a;
        }
        
        .message {
            margin-bottom: 15px;
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            line-height: 1.4;
            position: relative;
            animation: fadeIn 0.3s ease-in-out;
            word-wrap: break-word;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background-color: var(--user-message-bg);
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        
        .dark-mode .user-message {
            background-color: #2a3a4a;
            color: var(--dark-mode-text);
        }
        
        .bot-message {
            background-color: var(--bot-message-bg);
            margin-right: auto;
            border-bottom-left-radius: 5px;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }
        
        .dark-mode .bot-message {
            background-color: #2d2d2d;
            color: var(--dark-mode-text);
            box-shadow: 0 1px 1px rgba(0,0,0,0.3);
        }
        
        .input-area {
            display: flex;
            padding: 10px;
            background-color: white;
            border-top: 1px solid #eee;
            transition: background-color 0.3s;
        }
        
        .dark-mode .input-area {
            background-color: var(--dark-mode-card);
            border-top: 1px solid #333;
        }
        
        #user-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .dark-mode #user-input {
            background-color: #333;
            border-color: #444;
            color: var(--dark-mode-text);
        }
        
        #send-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 0 20px;
            margin-left: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #send-button:hover {
            background-color: var(--secondary-color);
        }
        
        .loading {
            color: #666;
            font-style: italic;
            text-align: center;
            padding: 10px;
        }
        
        .dark-mode .loading {
            color: #aaa;
        }
        
        .suggestions {
            display: flex;
            flex-wrap: wrap;
            padding: 10px;
            background-color: #f0f0f0;
            border-top: 1px solid #ddd;
            transition: all 0.3s;
        }
        
        .dark-mode .suggestions {
            background-color: #252525;
            border-top: 1px solid #444;
        }
        
        .suggestion-btn {
            background-color: #e0e0e0;
            border: none;
            border-radius: 15px;
            padding: 8px 12px;
            margin: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .dark-mode .suggestion-btn {
            background-color: #3a3a3a;
            color: var(--dark-mode-text);
        }
        
        .suggestion-btn:hover {
            background-color: #d0d0d0;
            transform: translateY(-2px);
        }
        
        .dark-mode .suggestion-btn:hover {
            background-color: #4a4a4a;
        }
        
        .typing-indicator {
            display: flex;
            padding: 10px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #888;
            border-radius: 50%;
            margin: 0 2px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .dark-mode .typing-dot {
            background-color: #aaa;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        
        .feedback-buttons {
            display: flex;
            justify-content: flex-end;
            margin-top: 5px;
        }
        
        .feedback-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin-left: 10px;
            opacity: 0.6;
            transition: opacity 0.2s;
        }
        
        .feedback-btn:hover {
            opacity: 1;
        }
        
        .settings-btn, .dark-mode-btn {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
        }
        
        .settings-panel {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            padding: 20px;
            transition: right 0.3s;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .dark-mode .settings-panel {
            background-color: var(--dark-mode-card);
            color: var(--dark-mode-text);
        }
        
        .settings-panel.active {
            right: 0;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-settings {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }
        
        .setting-item {
            margin-bottom: 15px;
        }
        
        .setting-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        select, input[type="range"] {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .dark-mode select, .dark-mode input[type="range"] {
            background-color: #333;
            border-color: #444;
            color: var(--dark-mode-text);
        }
        
        .media-attachment {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 5px;
        }
        
        .conversation-history {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        
        .dark-mode .conversation-history {
            border-color: #444;
        }
        
        .history-item {
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .voice-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .recording {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -60px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .progress-container {
            width: 100%;
            background-color: #f1f1f1;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .dark-mode .progress-container {
            background-color: #333;
        }
        
        .progress-bar {
            height: 10px;
            background-color: var(--primary-color);
            border-radius: 5px;
            width: 0%;
            transition: width 0.3s;
        }
        
        .personality-indicator {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }
        
        .dark-mode .personality-indicator {
            color: #aaa;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <span>‡§â‡§®‡•ç‡§®‡§§ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§ö‡•à‡§ü‡§¨‡•â‡§ü</span>
            <div class="header-actions">
                <button class="dark-mode-btn" onclick="toggleDarkMode()">üåì</button>
                <button class="settings-btn tooltip" onclick="toggleSettings()">
                    ‚öôÔ∏è
                    <span class="tooltiptext">‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏</span>
                </button>
            </div>
        </div>
        <div class="chat-box" id="chat-box"></div>
        <div class="suggestions" id="suggestions">
            <button class="suggestion-btn" onclick="insertSuggestion('‡§®‡§Æ‡§∏‡•ç‡§§‡•á')">‡§®‡§Æ‡§∏‡•ç‡§§‡•á</button>
            <button class="suggestion-btn" onclick="insertSuggestion('‡§§‡•Å‡§Æ ‡§ï‡•å‡§® ‡§π‡•ã')">‡§§‡•Å‡§Æ ‡§ï‡•å‡§® ‡§π‡•ã</button>
            <button class="suggestion-btn" onclick="insertSuggestion('‡§Ü‡§ú ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à')">‡§Ü‡§ú ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ</button>
            <button class="suggestion-btn" onclick="insertSuggestion('‡§Æ‡•å‡§∏‡§Æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä')">‡§Æ‡•å‡§∏‡§Æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä</button>
        </div>
        <div class="input-area">
            <button class="voice-btn tooltip" id="voice-btn" onclick="toggleVoiceInput()">
                üé§
                <span class="tooltiptext">‡§µ‡•â‡§á‡§∏ ‡§á‡§®‡§™‡•Å‡§ü</span>
            </button>
            <input type="text" id="user-input" placeholder="‡§Ö‡§™‡§®‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≤‡§ø‡§ñ‡•á‡§Ç..." 
                   onkeydown="if(event.key === 'Enter') sendMessage()">
            <button id="send-button" onclick="sendMessage()">‡§≠‡•á‡§ú‡•á‡§Ç</button>
        </div>
    </div>

    <!-- ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§™‡•à‡§®‡§≤ -->
    <div class="settings-panel" id="settings-panel">
        <div class="settings-header">
            <h3>‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏</h3>
            <button class="close-settings" onclick="toggleSettings()">√ó</button>
        </div>
        
        <div class="setting-item">
            <label for="voice-input">‡§µ‡•â‡§á‡§∏ ‡§á‡§®‡§™‡•Å‡§ü</label>
            <select id="voice-input">
                <option value="off">‡§¨‡§Ç‡§¶</option>
                <option value="on">‡§ö‡§æ‡§≤‡•Ç</option>
            </select>
        </div>
        
        <div class="setting-item">
            <label for="response-speed">‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ó‡§§‡§ø</label>
            <select id="response-speed">
                <option value="fast">‡§§‡•á‡§ú</option>
                <option value="normal" selected>‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø</option>
                <option value="slow">‡§ß‡•Ä‡§Æ‡§æ</option>
            </select>
        </div>
        
        <div class="setting-item">
            <label for="bot-personality">‡§¨‡•â‡§ü ‡§ï‡§æ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§§‡•ç‡§µ</label>
            <select id="bot-personality">
                <option value="professional">‡§™‡•á‡§∂‡•á‡§µ‡§∞</option>
                <option value="friendly" selected>‡§Æ‡§ø‡§§‡•ç‡§∞‡§µ‡§§</option>
                <option value="humorous">‡§π‡§æ‡§∏‡•ç‡§Ø‡§™‡•Ç‡§∞‡•ç‡§£</option>
                <option value="poetic">‡§ï‡§æ‡§µ‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ï</option>
            </select>
        </div>
        
        <div class="setting-item">
            <label for="font-size">‡§´‡•â‡§®‡•ç‡§ü ‡§Ü‡§ï‡§æ‡§∞</label>
            <input type="range" id="font-size" min="12" max="24" value="16" onchange="changeFontSize(this.value)">
            <span id="font-size-value">16px</span>
        </div>
        
        <div class="setting-item">
            <label>‡§µ‡§æ‡§∞‡•ç‡§§‡§æ‡§≤‡§æ‡§™ ‡§á‡§§‡§ø‡§π‡§æ‡§∏</label>
            <div class="conversation-history" id="conversation-history">
                ‡§ï‡•ã‡§à ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç
            </div>
            <button onclick="exportConversation()">‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
            <button onclick="clearHistory()">‡§∏‡§æ‡§´ ‡§ï‡§∞‡•á‡§Ç</button>
        </div>
        
        <div class="setting-item">
            <label>‡§™‡•ç‡§∞‡§ó‡§§‡§ø</label>
            <div class="progress-container">
                <div class="progress-bar" id="model-progress"></div>
            </div>
            <span id="progress-text">‡§Æ‡•â‡§°‡§≤ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</span>
        </div>
        
        <button onclick="resetConversation()">‡§µ‡§æ‡§∞‡•ç‡§§‡§æ‡§≤‡§æ‡§™ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
        <button onclick="resetPreferences()">‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ‡§è‡§Å ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
    </div>

    <!-- TensorFlow.js ‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <!-- TensorFlow.js ‡§ï‡•á ‡§≤‡§ø‡§è Universal Sentence Encoder -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@1.3.2/dist/universal-sentence-encoder.min.js"></script>
    <!-- ‡§≠‡§æ‡§µ‡§®‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/sentiment"></script>
    
    <script>
        // ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§µ‡§∞‡•ç‡§ó
        class HindiChatbot {
            constructor() {
                this.model = null;
                this.encoder = null;
                this.sentimentModel = null;
                this.isTyping = false;
                this.knowledgeBase = [];
                this.conversationContext = {
                    lastQuestion: "",
                    userPreferences: {
                        name: "",
                        interests: [],
                        preferredLanguage: "hindi"
                    },
                    conversationHistory: [],
                    sentimentScore: 0,
                    waitingFor: null,
                    personality: "friendly"
                };
                this.recognition = null;
                this.isRecording = false;
                this.darkMode = false;
            }

            // ‡§™‡•á‡§ú ‡§≤‡•ã‡§° ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§á‡§®‡§ø‡§∂‡§ø‡§Ø‡§≤‡§æ‡§á‡§ú‡§º‡•á‡§∂‡§®
            async init() {
                this.updateProgress(10, "‡§ú‡•ç‡§û‡§æ‡§® ‡§Ü‡§ß‡§æ‡§∞ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...");
                await this.loadKnowledgeBase();
                
                this.updateProgress(30, "‡§≠‡§æ‡§∑‡§æ ‡§Æ‡•â‡§°‡§≤ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...");
                await this.loadLanguageModels();
                
                this.updateProgress(70, "‡§≠‡§æ‡§µ‡§®‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§Æ‡•â‡§°‡§≤ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...");
                await this.loadSentimentModel();
                
                this.updateProgress(90, "‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ‡§è‡§Å ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡•Ä ‡§π‡•à‡§Ç...");
                this.loadUserPreferences();
                this.loadLearnedResponses();
                
                this.updateProgress(100, "‡§§‡•à‡§Ø‡§æ‡§∞!");
                setTimeout(() => {
                    document.getElementById('model-progress').style.display = 'none';
                    document.getElementById('progress-text').style.display = 'none';
                }, 1000);
                
                this.addBotMessage("‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§è‡§ï ‡§â‡§®‡•ç‡§®‡§§ ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§ö‡•à‡§ü‡§¨‡•â‡§ü ‡§π‡•Ç‡§Å‡•§ ‡§Ü‡§™ ‡§Æ‡•Å‡§ù‡§∏‡•á ‡§ï‡•Å‡§õ ‡§≠‡•Ä ‡§™‡•Ç‡§õ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç!");
                this.initVoiceRecognition();
            }

            // ‡§™‡•ç‡§∞‡§ó‡§§‡§ø ‡§¨‡§æ‡§∞ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
            updateProgress(percent, message) {
                document.getElementById('model-progress').style.width = `${percent}%`;
                document.getElementById('progress-text').textContent = message;
            }

            // ‡§ú‡•ç‡§û‡§æ‡§® ‡§Ü‡§ß‡§æ‡§∞ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
            async loadKnowledgeBase() {
                try {
                    const response = await fetch('knowledgeBase.json');
                    if (!response.ok) throw new Error('Failed to load knowledgeBase.json');
                    
                    const data = await response.json();
                    this.knowledgeBase = data.map(item => {
                        if (typeof item.answer === 'string' && item.answer.startsWith('function:')) {
                            const funcName = item.answer.replace('function:', '');
                            item.answer = this.functionMappings[funcName] || item.answer;
                        }
                        if (item.followUp && item.followUp.handler.startsWith('function:')) {
                            const funcName = item.followUp.handler.replace('function:', '');
                            item.followUp.handler = this.functionMappings[funcName] || item.followUp.handler;
                        }
                        return item;
                    });
                } catch (error) {
                    console.error('Error loading knowledge base:', error);
                    this.addBotMessage('‡§ú‡•ç‡§û‡§æ‡§® ‡§Ü‡§ß‡§æ‡§∞ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§ ‡§°‡§ø‡§´‡•â‡§≤‡•ç‡§ü ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Å ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•Ä ‡§ú‡§æ‡§è‡§Ç‡§ó‡•Ä‡•§');
                }
            }

            // ‡§≠‡§æ‡§∑‡§æ ‡§Æ‡•â‡§°‡§≤ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
            async loadLanguageModels() {
                try {
                    this.encoder = await use.load();
                    this.model = await use.loadQnA();
                } catch (error) {
                    console.error("‡§Æ‡•â‡§°‡§≤ ‡§≤‡•ã‡§°‡§ø‡§Ç‡§ó ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø:", error);
                    this.addBotMessage("‡§≠‡§æ‡§∑‡§æ ‡§Æ‡•â‡§°‡§≤ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§à‡•§ ‡§ï‡•Å‡§õ ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ‡§è‡§Å ‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à‡§Ç‡•§");
                }
            }

            // ‡§≠‡§æ‡§µ‡§®‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§Æ‡•â‡§°‡§≤ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
            async loadSentimentModel() {
                try {
                    this.sentimentModel = await tf.loadLayersModel(
                        'https://storage.googleapis.com/tfjs-models/tfjs/sentiment_cnn_v1/model.json'
                    );
                } catch (error) {
                    console.error("‡§≠‡§æ‡§µ‡§®‡§æ ‡§Æ‡•â‡§°‡§≤ ‡§≤‡•ã‡§°‡§ø‡§Ç‡§ó ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø:", error);
                }
            }

            // ‡§µ‡•â‡§á‡§∏ ‡§∞‡§ø‡§ï‡§ó‡•ç‡§®‡§ø‡§∂‡§® ‡§á‡§®‡§ø‡§∂‡§ø‡§Ø‡§≤‡§æ‡§á‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
            initVoiceRecognition() {
                if ('webkitSpeechRecognition' in window) {
                    this.recognition = new webkitSpeechRecognition();
                    this.recognition.continuous = false;
                    this.recognition.interimResults = false;
                    this.recognition.lang = 'hi-IN';
                    
                    this.recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        document.getElementById('user-input').value = transcript;
                        this.isRecording = false;
                        document.getElementById('voice-btn').classList.remove('recording');
                    };
                    
                    this.recognition.onerror = (event) => {
                        console.error("‡§µ‡•â‡§á‡§∏ ‡§∞‡§ø‡§ï‡§ó‡•ç‡§®‡§ø‡§∂‡§® ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø:", event.error);
                        this.isRecording = false;
                        document.getElementById('voice-btn').classList.remove('recording');
                    };
                } else {
                    console.warn("‡§µ‡•â‡§á‡§∏ ‡§∞‡§ø‡§ï‡§ó‡•ç‡§®‡§ø‡§∂‡§® ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à");
                }
            }

            // ‡§µ‡•â‡§á‡§∏ ‡§á‡§®‡§™‡•Å‡§ü ‡§ü‡•â‡§ó‡§≤ ‡§ï‡§∞‡•á‡§Ç
            toggleVoiceInput() {
                if (!this.recognition) {
                    alert("‡§Ü‡§™‡§ï‡•á ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Æ‡•á‡§Ç ‡§µ‡•â‡§á‡§∏ ‡§∞‡§ø‡§ï‡§ó‡•ç‡§®‡§ø‡§∂‡§® ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à");
                    return;
                }
                
                if (this.isRecording) {
                    this.recognition.stop();
                    this.isRecording = false;
                    document.getElementById('voice-btn').classList.remove('recording');
                } else {
                    this.recognition.start();
                    this.isRecording = true;
                    document.getElementById('voice-btn').classList.add('recording');
                    this.addBotMessage("‡§Æ‡•à‡§Ç ‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å...");
                }
            }

            // ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≠‡•á‡§ú‡•á‡§Ç
            async sendMessage() {
                const userInput = document.getElementById('user-input').value.trim();
                if (!userInput) return;
                
                this.addUserMessage(userInput);
                document.getElementById('user-input').value = '';
                this.showTypingIndicator();
                
                try {
                    this.updateContext(userInput);
                    await this.analyzeSentiment(userInput);
                    
                    const response = await this.getBotResponse(userInput);
                    this.hideTypingIndicator();
                    this.addBotMessage(response);
                    
                    this.conversationContext.conversationHistory[
                        this.conversationContext.conversationHistory.length - 1
                    ].bot = response;
                    
                    this.updateSuggestions();
                    this.updateConversationHistoryUI();
                } catch (error) {
                    this.hideTypingIndicator();
                    this.addBotMessage("‡§Æ‡§æ‡§´ ‡§ï‡•Ä‡§ú‡§ø‡§è, ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•á ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á ‡§™‡§æ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Å‡•§");
                    console.error("‡§§‡•ç‡§∞‡•Å‡§ü‡§ø:", error);
                }
            }

            // ‡§¨‡•â‡§ü ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç
            async getBotResponse(userInput) {
                // ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§§‡•ç‡§µ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
                this.conversationContext.personality = document.getElementById('bot-personality').value;
                
                // ‡§´‡•â‡§≤‡•ã-‡§Ö‡§™ ‡§ö‡•á‡§ï
                if (this.conversationContext.waitingFor) {
                    const lastQuestionObj = this.knowledgeBase.find(q => 
                        q.question === this.conversationContext.lastQuestion);
                    
                    if (lastQuestionObj && lastQuestionObj.followUp) {
                        const result = await lastQuestionObj.followUp.handler(userInput);
                        this.conversationContext.waitingFor = null;
                        return this.formatResponse(result);
                    }
                }
                
                // ‡§ú‡•ç‡§û‡§æ‡§® ‡§Ü‡§ß‡§æ‡§∞ ‡§Æ‡•á‡§Ç ‡§è‡§ï‡•ç‡§∏‡•à‡§ï‡•ç‡§ü ‡§Æ‡•à‡§ö
                const exactMatch = this.knowledgeBase.find(item => 
                    item.question.toLowerCase() === userInput.toLowerCase());
                
                if (exactMatch) {
                    if (typeof exactMatch.answer === 'function') {
                        return this.formatResponse(exactMatch.answer(this.conversationContext));
                    }
                    
                    if (exactMatch.followUp) {
                        this.conversationContext.waitingFor = exactMatch.followUp.field;
                        this.conversationContext.lastQuestion = exactMatch.question;
                    }
                    
                    return this.formatResponse(exactMatch.answer);
                }
                
                // ‡§∏‡§ø‡§Æ‡•á‡§Ç‡§ü‡§ø‡§ï ‡§Æ‡•à‡§ö‡§ø‡§Ç‡§ó
                if (this.encoder && this.model) {
                    const input = {
                        queries: [userInput],
                        responses: this.knowledgeBase.map(item => item.question)
                    };
                    
                    const embeddings = await this.model.embed(input);
                    const scores = tf.matMul(
                        embeddings['queryEmbedding'],
                        embeddings['responseEmbedding'],
                        false, true
                    ).dataSync();
                    
                    let maxScore = -1;
                    let bestMatchIndex = -1;
                    
                    for (let i = 0; i < scores.length; i++) {
                        if (scores[i] > maxScore) {
                            maxScore = scores[i];
                            bestMatchIndex = i;
                        }
                    }
                    
                    if (maxScore > 0.5) {
                        const matchedQuestion = this.knowledgeBase[bestMatchIndex];
                        
                        if (matchedQuestion.followUp) {
                            this.conversationContext.waitingFor = matchedQuestion.followUp.field;
                            this.conversationContext.lastQuestion = matchedQuestion.question;
                        }
                        
                        if (typeof matchedQuestion.answer === 'function') {
                            return this.formatResponse(matchedQuestion.answer(this.conversationContext));
                        }
                        return this.formatResponse(matchedQuestion.answer);
                    }
                }
                
                // ‡§≠‡§æ‡§µ‡§®‡§æ-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ
                if (this.conversationContext.sentimentScore < 0.3) {
                    const negativeResponses = {
                        professional: "‡§Æ‡•Å‡§ù‡•á ‡§≤‡§ó‡§§‡§æ ‡§π‡•à ‡§Ü‡§™ ‡§®‡§æ‡§ñ‡•Å‡§∂ ‡§π‡•à‡§Ç‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡§§‡§æ‡§è‡§Ç ‡§ï‡§ø ‡§Æ‡•à‡§Ç ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å?",
                        friendly: "‡§≤‡§ó‡§§‡§æ ‡§π‡•à ‡§Ü‡§™ ‡§™‡§∞‡•á‡§∂‡§æ‡§® ‡§π‡•à‡§Ç‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡•à‡§Ç ‡§ï‡•Å‡§õ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å?",
                        humorous: "‡§ì‡§π‡•ã! ‡§ï‡§ø‡§∏‡§®‡•á ‡§Ü‡§™‡§ï‡§æ ‡§Æ‡•Ç‡§° ‡§ñ‡§∞‡§æ‡§¨ ‡§ï‡§ø‡§Ø‡§æ? ‡§ö‡§≤‡•ã ‡§Æ‡•à‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å!",
                        poetic: "‡§ï‡•ç‡§∞‡•ã‡§ß ‡§ï‡•á ‡§¨‡§æ‡§¶‡§≤ ‡§õ‡§æ‡§è ‡§π‡•à‡§Ç, ‡§∂‡§æ‡§Ç‡§§‡§ø ‡§ï‡•Ä ‡§µ‡§∞‡•ç‡§∑‡§æ ‡§π‡•ã‡§®‡•á ‡§¶‡•ã‡•§ ‡§¨‡§§‡§æ‡§á‡§è, ‡§ï‡•à‡§∏‡•á ‡§∏‡•á‡§µ‡§æ ‡§ï‡§∞‡•Ç‡§Å?"
                    };
                    return negativeResponses[this.conversationContext.personality] || 
                        "‡§Æ‡•Å‡§ù‡•á ‡§≤‡§ó‡§§‡§æ ‡§π‡•à ‡§Ü‡§™ ‡§®‡§æ‡§∞‡§æ‡§ú‡§º ‡§π‡•à‡§Ç‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡§ø‡§∏‡•Ä ‡§§‡§∞‡§π ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å?";
                }
                
                // ‡§°‡§ø‡§´‡•â‡§≤‡•ç‡§ü ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Å
                const defaultResponses = {
                    professional: [
                        "‡§Æ‡§æ‡§´ ‡§ï‡•Ä‡§ú‡§ø‡§è, ‡§Æ‡•à‡§Ç ‡§á‡§∏ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡•ã ‡§∏‡§Æ‡§ù ‡§®‡§π‡•Ä‡§Ç ‡§™‡§æ‡§Ø‡§æ‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏‡•á ‡§Ö‡§≤‡§ó ‡§§‡§∞‡•Ä‡§ï‡•á ‡§∏‡•á ‡§™‡•Ç‡§õ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç?",
                        "‡§Æ‡•à‡§Ç ‡§Ö‡§≠‡•Ä ‡§á‡§∏ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á ‡§∏‡§ï‡§§‡§æ‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§ï‡•ã‡§à ‡§Ö‡§®‡•ç‡§Ø ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ‡§®‡§æ ‡§ö‡§æ‡§π‡•á‡§Ç‡§ó‡•á?"
                    ],
                    friendly: [
                        "‡§Æ‡•Å‡§ù‡•á ‡§∏‡§Æ‡§ù ‡§®‡§π‡•Ä‡§Ç ‡§Ü‡§Ø‡§æ‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ï‡§π ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç?",
                        "‡§π‡§Æ‡•ç‡§Æ... ‡§Æ‡•à‡§Ç ‡§á‡§∏ ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§ú‡§æ‡§®‡§§‡§æ‡•§ ‡§ï‡•Å‡§õ ‡§î‡§∞ ‡§™‡•Ç‡§õ‡§ø‡§è!"
                    ],
                    humorous: [
                        "‡§Ö‡§∞‡•á ‡§≠‡§à! ‡§Ø‡§π ‡§§‡•ã ‡§Æ‡•á‡§∞‡•Ä ‡§∏‡§Æ‡§ù ‡§∏‡•á ‡§¨‡§æ‡§π‡§∞ ‡§π‡•à‡•§ ‡§ï‡•Å‡§õ ‡§Ü‡§∏‡§æ‡§® ‡§∏‡§µ‡§æ‡§≤ ‡§™‡•Ç‡§õ‡•ã!",
                        "‡§Æ‡•á‡§∞‡•Ä ‡§¨‡•Å‡§¶‡•ç‡§ß‡§ø ‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§ï‡§∞ ‡§†‡§ø‡§†‡§ï ‡§ó‡§à ‡§π‡•à‡•§ ‡§ï‡•ã‡§à ‡§¶‡•Ç‡§∏‡§∞‡§æ ‡§∏‡§µ‡§æ‡§≤?"
                    ],
                    poetic: [
                        "‡§á‡§∏ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§Æ‡•á‡§∞‡•Ä ‡§ú‡•ç‡§û‡§æ‡§®-‡§ó‡§Ç‡§ó‡§æ ‡§Æ‡•á‡§Ç ‡§®‡§π‡•Ä‡§Ç ‡§¨‡§π‡§§‡§æ‡•§ ‡§ï‡•Å‡§õ ‡§î‡§∞ ‡§™‡•Ç‡§õ‡•ã ‡§™‡•ç‡§∞‡§ø‡§Ø!",
                        "‡§Æ‡•á‡§∞‡•Ä ‡§¨‡•Å‡§¶‡•ç‡§ß‡§ø ‡§ï‡•Ä ‡§∏‡•Ä‡§Æ‡§æ ‡§Ø‡§π‡•Ä‡§Ç ‡§§‡§ï ‡§π‡•à‡•§ ‡§Ö‡§®‡•ç‡§Ø ‡§ú‡§ø‡§ú‡•ç‡§û‡§æ‡§∏‡§æ ‡§≤‡•á‡§ï‡§∞ ‡§Ü‡§á‡§è‡•§"
                    ]
                };
                
                const responses = defaultResponses[this.conversationContext.personality] || [
                    "‡§Æ‡•Å‡§ù‡•á ‡§á‡§∏ ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Æ‡•Å‡§ù‡•á ‡§∏‡§ø‡§ñ‡§æ‡§è‡§Ç - ‡§Ö‡§ó‡§∞ ‡§Ü‡§™ ‡§ö‡§æ‡§π‡•á‡§Ç ‡§§‡•ã ‡§∏‡§π‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§≤‡§ø‡§ñ‡§ï‡§∞ ‡§≠‡•á‡§ú ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç ‡§î‡§∞ ‡§Æ‡•à‡§Ç ‡§á‡§∏‡•á ‡§∏‡•Ä‡§ñ ‡§≤‡•Ç‡§Å‡§ó‡§æ‡•§"
                ];
                
                return this.formatResponse(responses[Math.floor(Math.random() * responses.length)]);
            }

            // ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§´‡•â‡§∞‡•ç‡§Æ‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç (‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§§‡•ç‡§µ ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞)
            formatResponse(response) {
                if (this.conversationContext.personality === 'poetic') {
                    // ‡§ï‡§æ‡§µ‡•ç‡§Ø‡§æ‡§§‡•ç‡§Æ‡§ï ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Å ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
                    const poeticEnhancements = [
                        "\n\n- ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡§æ ‡§¶‡•Ä‡§™‡§ï ‡§ú‡§≤‡§§‡§æ ‡§∞‡§π‡•á",
                        "\n\n- ‡§∏‡§§‡•ç‡§Ø‡§Æ, ‡§∂‡§ø‡§µ‡§Æ, ‡§∏‡•Å‡§Ç‡§¶‡§∞‡§Æ",
                        "\n\n- ‡§ú‡•ç‡§û‡§æ‡§® ‡§ó‡§Ç‡§ó‡§æ ‡§ï‡•Ä ‡§Ø‡§π ‡§ß‡§æ‡§∞‡§æ",
                        "\n\n- ‡§¨‡•Å‡§¶‡•ç‡§ß‡§ø ‡§ï‡§æ ‡§Ø‡§π ‡§™‡•ç‡§∞‡§ï‡§æ‡§∂ ‡§∏‡§¶‡§æ ‡§¨‡§®‡§æ ‡§∞‡§π‡•á"
                    ];
                    
                    if (Math.random() > 0.7) {
                        response += poeticEnhancements[Math.floor(Math.random() * poeticEnhancements.length)];
                    }
                }
                return response;
            }

            // ‡§≠‡§æ‡§µ‡§®‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£
            async analyzeSentiment(text) {
                try {
                    const inputText = text.trim().toLowerCase().replace(/([‡•§,!?])/g, '').split(' ');
                    const inputBuffer = tf.browser.fromPixels(inputText);
                    const prediction = await this.sentimentModel.predict(inputBuffer).data();
                    this.conversationContext.sentimentScore = prediction[0];
                } catch (error) {
                    console.error("‡§≠‡§æ‡§µ‡§®‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø:", error);
                }
            }

            // ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
            updateContext(userInput) {
                this.conversationContext.conversationHistory.push({
                    user: userInput,
                    bot: null,
                    timestamp: new Date().toISOString(),
                    sentiment: this.conversationContext.sentimentScore
                });
                
                if (this.conversationContext.conversationHistory.length > 10) {
                    this.conversationContext.conversationHistory.shift();
                }
            }

            // ‡§∏‡•Ä‡§ñ‡•á ‡§π‡•Å‡§è ‡§â‡§§‡•ç‡§§‡§∞ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
            loadLearnedResponses() {
                const learnedResponses = JSON.parse(
                    localStorage.getItem('learnedResponses') || '[]'
                );
                
                learnedResponses.forEach(response => {
                    if (!this.knowledgeBase.some(item => item.question === response.question)) {
                        this.knowledgeBase.push(response);
                    }
                });
            }

            // ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ‡§è‡§Å ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
            loadUserPreferences() {
                const savedPreferences = localStorage.getItem('userPreferences');
                if (savedPreferences) {
                    this.conversationContext.userPreferences = JSON.parse(savedPreferences);
                }
                
                // UI ‡§Æ‡•á‡§Ç ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
                if (this.conversationContext.userPreferences.darkMode) {
                    this.toggleDarkMode(true);
                }
                
                if (this.conversationContext.userPreferences.fontSize) {
                    this.changeFontSize(this.conversationContext.userPreferences.fontSize, true);
                }
            }

            // ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ‡§è‡§Å ‡§∏‡§π‡•á‡§ú‡•á‡§Ç
            saveUserPreferences() {
                localStorage.setItem(
                    'userPreferences',
                    JSON.stringify(this.conversationContext.userPreferences)
                );
            }

            // ‡§µ‡§æ‡§∞‡•ç‡§§‡§æ‡§≤‡§æ‡§™ ‡§á‡§§‡§ø‡§π‡§æ‡§∏ UI ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
            updateConversationHistoryUI() {
                const historyContainer = document.getElementById('conversation-history');
                historyContainer.innerHTML = '';
                
                if (this.conversationContext.conversationHistory.length === 0) {
                    historyContainer.innerHTML = '<div>‡§ï‡•ã‡§à ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç</div>';
                    return;
                }
                
                this.conversationContext.conversationHistory.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    const time = new Date(item.timestamp).toLocaleTimeString('hi-IN', {
                        hour: '2-digit', minute: '2-digit'
                    });
                    
                    historyItem.innerHTML = `
                        <strong>${time}:</strong> ${item.user.substring(0, 30)}${item.user.length > 30 ? '...' : ''}
                        ${item.bot ? `<br><em>‚Üí ${item.bot.substring(0, 30)}${item.bot.length > 30 ? '...' : ''}</em>` : ''}
                    `;
                    
                    historyContainer.appendChild(historyItem);
                });
            }

            // ‡§°‡§æ‡§∞‡•ç‡§ï ‡§Æ‡•ã‡§° ‡§ü‡•â‡§ó‡§≤ ‡§ï‡§∞‡•á‡§Ç
            toggleDarkMode(force = null) {
                if (force !== null) {
                    this.darkMode = force;
                } else {
                    this.darkMode = !this.darkMode;
                }
                
                if (this.darkMode) {
                    document.body.classList.add('dark-mode');
                } else {
                    document.body.classList.remove('dark-mode');
                }
                
                this.conversationContext.userPreferences.darkMode = this.darkMode;
                this.saveUserPreferences();
            }

            // ‡§´‡•â‡§®‡•ç‡§ü ‡§Ü‡§ï‡§æ‡§∞ ‡§¨‡§¶‡§≤‡•á‡§Ç
            changeFontSize(size, initialLoad = false) {
                document.documentElement.style.fontSize = `${size}px`;
                document.getElementById('font-size-value').textContent = `${size}px`;
                
                if (!initialLoad) {
                    this.conversationContext.userPreferences.fontSize = size;
                    this.saveUserPreferences();
                }
            }

            // ‡§µ‡§æ‡§∞‡•ç‡§§‡§æ‡§≤‡§æ‡§™ ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç
            exportConversation() {
                const data = JSON.stringify(this.conversationContext.conversationHistory, null, 2);
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `hindi-chatbot-conversation-${new Date().toISOString()}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            // ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§∏‡§æ‡§´ ‡§ï‡§∞‡•á‡§Ç
            clearHistory() {
                this.conversationContext.conversationHistory = [];
                this.updateConversationHistoryUI();
            }

            // ‡§µ‡§æ‡§∞‡•ç‡§§‡§æ‡§≤‡§æ‡§™ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
            resetConversation() {
                this.conversationContext = {
                    lastQuestion: "",
                    userPreferences: this.conversationContext.userPreferences,
                    conversationHistory: [],
                    sentimentScore: 0,
                    waitingFor: null,
                    personality: document.getElementById('bot-personality').value
                };
                
                this.addBotMessage("‡§µ‡§æ‡§∞‡•ç‡§§‡§æ‡§≤‡§æ‡§™ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§ ‡§Æ‡•à‡§Ç ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•Ç‡§Å!");
                this.updateSuggestions();
            }

            // ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ‡§è‡§Å ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
            resetPreferences() {
                this.conversationContext.userPreferences = {
                    name: "",
                    interests: [],
                    preferredLanguage: "hindi",
                    darkMode: false,
                    fontSize: 16
                };
                
                this.saveUserPreferences();
                this.toggleDarkMode(false);
                this.changeFontSize(16);
                this.addBotMessage("‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ‡§è‡§Å ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞ ‡§¶‡•Ä ‡§ó‡§à ‡§π‡•à‡§Ç‡•§");
            }

            // ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
            updateSuggestions() {
                const suggestionsContainer = document.getElementById('suggestions');
                suggestionsContainer.innerHTML = '';
                
                if (this.conversationContext.waitingFor === 'city') {
                    const cities = ['‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä', '‡§Æ‡•Å‡§Ç‡§¨‡§à', '‡§¨‡•à‡§Ç‡§ó‡§≤‡•ã‡§∞', '‡§ö‡•á‡§®‡•ç‡§®‡§à', '‡§ú‡§Ø‡§™‡•Å‡§∞'];
                    cities.forEach(city => {
                        const btn = document.createElement('button');
                        btn.className = 'suggestion-btn';
                        btn.textContent = city;
                        btn.onclick = () => insertSuggestion(city);
                        suggestionsContainer.appendChild(btn);
                    });
                } else {
                    const defaultSuggestions = [
                        '‡§®‡§Æ‡§∏‡•ç‡§§‡•á', 
                        '‡§§‡•Å‡§Æ ‡§ï‡•å‡§® ‡§π‡•ã', 
                        '‡§Ü‡§ú ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à',
                        '‡§∏‡§Æ‡§Ø ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•Å‡§Ü ‡§π‡•à',
                        '‡§Æ‡•å‡§∏‡§Æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä'
                    ];
                    
                    defaultSuggestions.forEach(suggestion => {
                        const btn = document.createElement('button');
                        btn.className = 'suggestion-btn';
                        btn.textContent = suggestion;
                        btn.onclick = () => insertSuggestion(suggestion);
                        suggestionsContainer.appendChild(btn);
                    });
                }
            }

            // ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® ‡§Æ‡•à‡§™‡§ø‡§Ç‡§ó
            functionMappings = {
                "time": () => {
                    const now = new Date();
                    const hours = now.getHours();
                    const minutes = now.getMinutes();
                    const timeString = `${hours} ‡§¨‡§ú‡§ï‡§∞ ${minutes} ‡§Æ‡§ø‡§®‡§ü`;
                    let greeting = "";
                    
                    if (hours < 12) greeting = "‡§∏‡•Å‡§™‡•ç‡§∞‡§≠‡§æ‡§§";
                    else if (hours < 18) greeting = "‡§®‡§Æ‡§∏‡•ç‡§§‡•á";
                    else greeting = "‡§∂‡•Å‡§≠ ‡§∏‡§Ç‡§ß‡•ç‡§Ø‡§æ";
                    
                    return `${greeting}! ‡§Ö‡§≠‡•Ä ‡§∏‡§Æ‡§Ø ‡§π‡•à ${timeString}`;
                },
                "date": () => {
                    const now = new Date();
                    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                    return `‡§Ü‡§ú ${now.toLocaleDateString('hi-IN', options)} ‡§π‡•à`;
                },
                "name": (context) => {
                    if (context.userPreferences.name) {
                        return `‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ ${context.userPreferences.name} ‡§π‡•à`;
                    }
                    return "‡§Æ‡•Å‡§ù‡•á ‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§™‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§Æ‡•Å‡§ù‡•á ‡§¨‡§§‡§æ‡§è‡§Ç‡§ó‡•á?";
                },
                "weather": async (city) => {
                    return await this.getWeather(city);
                },
                "nameHandler": (name) => {
                    this.conversationContext.userPreferences.name = name;
                    this.saveUserPreferences();
                    return `‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Æ‡•à‡§Ç‡§®‡•á ‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ ${name} ‡§∏‡§π‡•á‡§ú ‡§≤‡§ø‡§Ø‡§æ ‡§π‡•à‡•§`;
                }
            };

            // ‡§Æ‡•å‡§∏‡§Æ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä
            async getWeather(city) {
                const mockWeatherData = {
                    "delhi": "‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§Æ‡•á‡§Ç ‡§Ü‡§ú ‡§ï‡§æ ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡§æ‡§´ ‡§π‡•à, ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§§‡§æ‡§™‡§Æ‡§æ‡§® 35¬∞C ‡§î‡§∞ ‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ 28¬∞C ‡§∞‡§π‡§®‡•á ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§® ‡§π‡•à‡•§",
                    "mumbai": "‡§Æ‡•Å‡§Ç‡§¨‡§à ‡§Æ‡•á‡§Ç ‡§Ü‡§ú ‡§¨‡§æ‡§¶‡§≤ ‡§õ‡§æ‡§è ‡§∞‡§π‡§®‡•á ‡§ï‡•á ‡§∏‡§æ‡§• ‡§π‡§≤‡•ç‡§ï‡•Ä ‡§¨‡§æ‡§∞‡§ø‡§∂ ‡§ï‡•Ä ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§π‡•à, ‡§§‡§æ‡§™‡§Æ‡§æ‡§® 30¬∞C ‡§ï‡•á ‡§Ü‡§∏‡§™‡§æ‡§∏ ‡§∞‡§π‡•á‡§ó‡§æ‡•§",
                    "bangalore": "‡§¨‡•à‡§Ç‡§ó‡§≤‡•ã‡§∞ ‡§Æ‡•á‡§Ç ‡§Ü‡§ú ‡§π‡§≤‡•ç‡§ï‡•Ä ‡§ß‡•Ç‡§™ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Æ‡•å‡§∏‡§Æ ‡§∏‡•Å‡§π‡§æ‡§µ‡§®‡§æ ‡§∞‡§π‡•á‡§ó‡§æ, ‡§§‡§æ‡§™‡§Æ‡§æ‡§® 26¬∞C ‡§∏‡•á 32¬∞C ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§∞‡§π ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§",
                    "jaipur": "‡§ú‡§Ø‡§™‡•Å‡§∞ ‡§Æ‡•á‡§Ç ‡§Ü‡§ú ‡§ß‡•Ç‡§™ ‡§∞‡§π‡•á‡§ó‡•Ä, ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§§‡§æ‡§™‡§Æ‡§æ‡§® 38¬∞C ‡§§‡§ï ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§",
                    "chennai": "‡§ö‡•á‡§®‡•ç‡§®‡§à ‡§Æ‡•á‡§Ç ‡§Ü‡§ú ‡§â‡§Æ‡§∏ ‡§≠‡§∞‡§æ ‡§Æ‡•å‡§∏‡§Æ ‡§∞‡§π‡•á‡§ó‡§æ, ‡§§‡§æ‡§™‡§Æ‡§æ‡§® 32¬∞C ‡§ï‡•á ‡§Ü‡§∏‡§™‡§æ‡§∏ ‡§∞‡§π‡§®‡•á ‡§ï‡•Ä ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§®‡§æ ‡§π‡•à‡•§"
                };
                
                const normalizedCity = city.toLowerCase().trim();
                return mockWeatherData[normalizedCity] || 
                    `‡§Æ‡•Å‡§ù‡•á ${city} ‡§ï‡•á ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§ø‡§∏‡•Ä ‡§Ö‡§®‡•ç‡§Ø ‡§∂‡§π‡§∞ ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§¶‡•á‡§Ç‡•§`;
            }

            // ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
            addUserMessage(message) {
                const chatBox = document.getElementById('chat-box');
                chatBox.innerHTML += `<div class="user-message message">${message}</div>`;
                chatBox.scrollTop = chatBox.scrollHeight;
            }
            
            // ‡§¨‡•â‡§ü ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
            addBotMessage(message) {
                const chatBox = document.getElementById('chat-box');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'bot-message message';
                messageDiv.innerHTML = message;
                
                // ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§§‡•ç‡§µ ‡§∏‡§Ç‡§ï‡•á‡§§‡§ï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
                const personalityIndicator = document.createElement('div');
                personalityIndicator.className = 'personality-indicator';
                personalityIndicator.textContent = `‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§§‡•ç‡§µ: ${this.conversationContext.personality}`;
                messageDiv.appendChild(personalityIndicator);
                
                // ‡§´‡•Ä‡§°‡§¨‡•à‡§ï ‡§¨‡§ü‡§®
                const feedbackDiv = document.createElement('div');
                feedbackDiv.className = 'feedback-buttons';
                feedbackDiv.innerHTML = `
                    <button class="feedback-btn" onclick="rateResponse(this, true)">üëç</button>
                    <button class="feedback-btn" onclick="rateResponse(this, false)">üëé</button>
                `;
                
                messageDiv.appendChild(feedbackDiv);
                chatBox.appendChild(messageDiv);
                chatBox.scrollTop = chatBox.scrollHeight;
            }
            
            // ‡§ü‡§æ‡§á‡§™‡§ø‡§Ç‡§ó ‡§á‡§Ç‡§°‡§ø‡§ï‡•á‡§ü‡§∞ ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç
            showTypingIndicator() {
                const chatBox = document.getElementById('chat-box');
                const typingDiv = document.createElement('div');
                typingDiv.className = 'typing-indicator';
                typingDiv.id = 'typing-indicator';
                
                for (let i = 0; i < 3; i++) {
                    const dot = document.createElement('div');
                    dot.className = 'typing-dot';
                    typingDiv.appendChild(dot);
                }
                
                chatBox.appendChild(typingDiv);
                chatBox.scrollTop = chatBox.scrollHeight;
            }
            
            // ‡§ü‡§æ‡§á‡§™‡§ø‡§Ç‡§ó ‡§á‡§Ç‡§°‡§ø‡§ï‡•á‡§ü‡§∞ ‡§õ‡§ø‡§™‡§æ‡§è‡§Ç
            hideTypingIndicator() {
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }
        }

        // ‡§ó‡•ç‡§≤‡•ã‡§¨‡§≤ ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®‡•ç‡§∏
        const chatbot = new HindiChatbot();
        
        function sendMessage() {
            chatbot.sendMessage();
        }
        
        function insertSuggestion(text) {
            document.getElementById('user-input').value = text;
            document.getElementById('user-input').focus();
        }
        
        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            panel.classList.toggle('active');
        }
        
        function toggleDarkMode() {
            chatbot.toggleDarkMode();
        }
        
        function toggleVoiceInput() {
            chatbot.toggleVoiceInput();
        }
        
        function rateResponse(button, isPositive) {
            const feedbackButtons = button.parentElement.querySelectorAll('.feedback-btn');
            feedbackButtons.forEach(btn => {
                btn.style.opacity = '0.5';
                btn.disabled = true;
            });
            
            button.style.opacity = '1';
            console.log(`User rated response as ${isPositive ? 'positive' : 'negative'}`);
        }
        
        function changeFontSize(size) {
            chatbot.changeFontSize(size);
        }
        
        function exportConversation() {
            chatbot.exportConversation();
        }
        
        function clearHistory() {
            chatbot.clearHistory();
        }
        
        function resetConversation() {
            chatbot.resetConversation();
            toggleSettings();
        }
        
        function resetPreferences() {
            chatbot.resetPreferences();
            toggleSettings();
        }

        // ‡§™‡•á‡§ú ‡§≤‡•ã‡§° ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§á‡§®‡§ø‡§∂‡§ø‡§Ø‡§≤‡§æ‡§á‡§ú‡§º ‡§ï‡§∞‡•á‡§Ç
        window.onload = function() {
            chatbot.init();
        };
    </script>
</body>
</html>