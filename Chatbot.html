<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>"Chat with May AIЁЯХ╕"</title>
  <style>
    /* рдмреЗрд╕рд┐рдХ рд▓реЗрдЖрдЙрдЯ & рдлреЛрдВрдЯ */
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #FFFFFF5E, #B80000;
      display: flex;
      height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }
    .bubbles {
    position: absolute;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    overflow: hidden;
    z-index: -10;
}

.bubbles span {
    position: absolute;
    bottom: -100px;
    width: 20px;
    height: 20px;
    background: #C400FF;
    border-radius: 100%;
    opacity: 0.5;
    animation: bubbleAnimation linear infinite;
}

/* рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕рд╛рдЗрдЬ рдХреЗ рдмрдмрд▓реНрд╕ */
.bubbles span:nth-child(1) { left: 10%; animation-duration: 8s; animation-delay: 0s; }
.bubbles span:nth-child(2) { left: 20%; animation-duration: 10s; animation-delay: 2s; width: 30px; height: 30px; }
.bubbles span:nth-child(3) { left: 35%; animation-duration: 12s; animation-delay: 4s; width: 25px; height: 25px; }
.bubbles span:nth-child(4) { left: 50%; animation-duration: 9s; animation-delay: 1s; width: 40px; height: 40px; }
.bubbles span:nth-child(5) { left: 65%; animation-duration: 7s; animation-delay: 3s; width: 20px; height: 20px; }
.bubbles span:nth-child(6) { left: 80%; animation-duration: 11s; animation-delay: 2s; width: 35px; height: 35px; }
.bubbles span:nth-child(7) { left: 90%; animation-duration: 13s; animation-delay: 5s; width: 45px; height: 45px; }
.bubbles span:nth-child(8) { left: 75%; animation-duration: 8s; animation-delay: 5s; width: 25px; height: 25px; }
.bubbles span:nth-child(9) { left: 90%; animation-duration: 13s; animation-delay: 5s; width: 45px; height: 45px; }
.bubbles span:nth-child(10) { center: 90%; animation-duration: 3s; animation-delay: 5s; width: 45px; height: 45px; }

/* рдмрдмрд▓реНрд╕ рдХреЗ рд▓рд┐рдП рдПрдирд┐рдореЗрд╢рди */
@keyframes bubbleAnimation {
    0% {
        transform: translateY(0);
        opacity: 0.5;
    }
    50% {
        opacity: 1;
    }
    100% {
        transform: translateY(-100vh);
        opacity: 0;
    }
}


    /* рд╕рд╛рдЗрдбрдмрд╛рд░ (рдЪреИрдЯ рд╕рддреНрд░ рд╕реВрдЪреА) */
    .sidebar {
      width: 250px;
      background: #FCFCFF;
      border-right: 1px solid #ccc;
      padding: 10px;
      overflow-y: auto;
    }
    .sidebar h2 {
      font-size: 18px;
      margin-top: 0;
    }
    .session-item {
      padding: 8px;
      margin: 5px 0;
      cursor: pointer;
      border: 1px solid #ddd;
      border-radius: 3px;
      position: relative;
    }
    .session-item.active {
      background: #e0e0e0;
    }
    .session-item button.delete-session {
      position: absolute;
      right: 5px;
      top: 5px;
      background: #f44336;
      border: none;
      color: #fff;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      cursor: pointer;
      font-size: 12px;
      line-height: 18px;
    }
    .new-session-btn {
      width: 100%;
      padding: 8px;
      margin-top: 10px;
      background: #4CAF50;
      color: #fff;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    .new-session-btn:hover {
      background: #45a049;
    }
    /* рдореБрдЦреНрдп рдЪреИрдЯ рд╡рд┐рдВрдбреЛ */
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .chat-header {
      padding: 10px;
      background: #fff;
      border-bottom: 1px solid #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .clear-chat-btn {
      padding: 5px 10px;
      background: #f44336;
      color: #fff;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    .clear-chat-btn:hover {
      background: #d32f2f;
    }
    #chat-window {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: #FFFFFF;
    }
    .message {
      margin: 10px 0;
      padding: 8px 12px;
      border-radius: 20px;
      word-wrap: break-word;
      position: relative;
    }
    .message span.timestamp {
      display: block;
      font-size: 10px;
      color: #777777;
      margin-top: 4px;
      text-align: right;
    }
    .user {
      background: #000000;
      align-self: flex-end;
      text-align: right;
      color: #FFFFFF;
    }
    .bot {
      background: #052BFFE0;
      align-self: flex-start;
      text-align: left;
      color: #FFFFFF;
    }
    .input-area {
      display: flex;
      border-top: 1px solid #ccc;
      padding: 10px;
      background: #fff;
    }
    #user-input {
      flex: 1;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 3px;
    }
    #send-button {
      padding: 10px 15px;
      margin-left: 10px;
      border: none;
      background: #037EBC;
      color: #FFFFFF;
      font-size: 16px;
      cursor: pointer;
      border-radius: 3px;
    }
    #send-button:hover {
      background: #45a049;
    }
    #typing-indicator {
      font-size: 20px;
      color: #3F6742;
      margin: 10px;
      display: none;
    }
  </style>
</head>
<body>
    <div class="bubbles">
        <span>1</span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
    </div>
    
  <!-- рд╕рд╛рдЗрдбрдмрд╛рд░: рдЪреИрдЯ рд╕рддреНрд░ рд╕реВрдЪреА -->
  <div class="sidebar">
    <h2>Chat</h2>
    <div id="session-list"><!-- рд╕рддреНрд░ рдЖрдЗрдЯрдо рдпрд╣рд╛рдБ рджрд┐рдЦреЗрдВрдЧреЗ --></div>
    <button class="new-session-btn" id="new-session-btn">New Chat</button>
  </div>
  
  <!-- рдореБрдЦреНрдп рдЪреИрдЯ рд╡рд┐рдВрдбреЛ -->
  <div class="chat-container">
    <div class="chat-header">
      <span id="session-title">chat</span>
      <button class="clear-chat-btn" id="clear-chat-btn">All chat deleted</button>
    </div>
    <div id="chat-window"><!-- рдЪреИрдЯ рд╕рдВрджреЗрд╢ рдпрд╣рд╛рдБ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрдВрдЧреЗ --></div>
    <div id="typing-indicator">тЧПтЧПтЧП</div>
    <div class="input-area">
      <input type="text" id="user-input" 
      placeholder="type your massage...." autocomplete="off">
      <button id="send-button">тмЖя╕П</button>
    </div>
  </div>
  
  <script>
    /******************************************************************
     * JSON DATA рд▓реЛрдб рдХрд░рдирд╛ (data.json)
     ******************************************************************/
    // data.json рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЕрдкреЗрдХреНрд╖рд┐рдд рд╕реНрдЯреНрд░рдХреНрдЪрд░ (рдЙрджрд╛рд╣рд░рдг):
    // {
    //   "knowledgeBase": [ { "question": "рдирдорд╕реНрддреЗ", "answer": "рдирдорд╕реНрддреЗ! рдХреИрд╕реЗ рд╣реЛ рдЖрдк?" }, ... ],
    //   "extendedData": [ { "question": "free fire рдХреНрдпрд╛ рд╣реИ", "answer": "Free Fire ..." }, ... ],
    //   "subjectData": { "рдЗрдВрдбрд┐рдпрд╛": "рдЗрдВрдбрд┐рдпрд╛ рд╕рдмрд╕реЗ рд╕реБрдиреНрджрд░, рдЖрдЫреНрдЫрд╛ рдУрд░ рдПрд╕рд┐рдпрдореЗ рдмрд╕рд╛ рд╣реБрдЖ рджреЗрд╕ рд╣реЗред", ... },
    //   "jokes": [ "рдЬреЛрд╝рдХ 1", "рдЬреЛрд╝рдХ 2", ... ],
    //   "quotes": [ "рдЙрджреНрдзрд░рдг 1", "рдЙрджреНрдзрд░рдг 2", ... ]
    // }
    let knowledgeBase = [];
    let extendedData = [];
    let bestanswer = [];
    let subjectData = {};
    let jokes = [];
    let quotes = [];
    
    function loadData() {
      return fetch('data.json')
        .then(response => response.json())
        .then(data => {
          knowledgeBase = data.knowledgeBase;
          extendedData = data.extendedData;
          bestanswer = data.bestanswer;
          subjectData = data.subjectData;
          jokes = data.jokes;
          quotes = data.quotes;
        })
        .catch(err => console.error("JSON рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдиреЗ рдореЗрдВ рддреНрд░реБрдЯрд┐:", err));
    }
    
    /******************************************************************
     * рдЕрдиреНрдп рдЧреНрд▓реЛрдмрд▓ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдФрд░ рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди
     ******************************************************************/
    let pendingQuestion = null;
    let editingKnowledgeEntry = null;
    const synonyms = {
      "my": "рдореЗрд░рд╛",
      "name": "рдирд╛рдо",
      "is": "рд╣реИ",
      "hi": "рдирдорд╕реНрддреЗ",
      "hello": "рдирдорд╕реНрддреЗ",
       
  "good": "рдЕрдЪреНрдЫрд╛",
  "bad": "рдмреБрд░рд╛",
  "morning": "рд╕реБрдмрд╣",
  "night": "рд░рд╛рдд",
  "food": "рднреЛрдЬрди",
  "water": "рдкрд╛рдиреА",
  "sun": "рд╕реВрд░рдЬ",
  "moon": "рдЪрд╛рдБрдж",
  "star": "рддрд╛рд░рд╛",
  "earth": "рдкреГрдереНрд╡реА",
  "sky": "рдЖрд╕рдорд╛рди",
  "friend": "рджреЛрд╕реНрдд",
  "family": "рдкрд░рд┐рд╡рд╛рд░",
  "love": "рдкреНрд░реЗрдо",
  "happy": "рдЦреБрд╢",
  "sad": "рдЙрджрд╛рд╕",
  "fast": "рддреЗрдЬрд╝",
  "slow": "рдзреАрдорд╛",
  "run": "рджреМрдбрд╝рдирд╛",
  "walk": "рдЪрд▓рдирд╛",
  "speak": "рдмреЛрд▓рдирд╛",
  "write": "рд▓рд┐рдЦрдирд╛",
  "read": "рдкрдврд╝рдирд╛",
  "see": "рджреЗрдЦрдирд╛",
  "hear": "рд╕реБрдирдирд╛",
  "think": "рд╕реЛрдЪрдирд╛",
  "work": "рдХрд╛рдо",
  "home": "рдШрд░",
  "school": "рд╡рд┐рджреНрдпрд╛рд▓рдп",
  "teacher": "рд╢рд┐рдХреНрд╖рдХ",
  "student": "рдЫрд╛рддреНрд░",
  "computer": "рдХрдВрдкреНрдпреВрдЯрд░",
  "mobile": "рдореЛрдмрд╛рдЗрд▓",
  "internet": "рдЗрдВрдЯрд░рдиреЗрдЯ",
  "coding": "рдХреЛрдбрд┐рдВрдЧ",
  "language": "рднрд╛рд╖рд╛",
  "password": "рдкрд╛рд╕рд╡рд░реНрдб",
  "username": "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо",
  "login": "рд▓реЙрдЧрд┐рди",
  "logout": "рд▓реЙрдЧрдЖрдЙрдЯ",
  "encrypt": "рдПрдирдХреНрд░рд┐рдкреНрдЯ",
  "decrypt": "рдбрд┐рдХреНрд░рд┐рдкреНрдЯ",
  "security": "рд╕реБрд░рдХреНрд╖рд╛",
  "authentication": "рдкреНрд░рдорд╛рдгреАрдХрд░рдг",
  "authorization": "рдЕрдиреБрдореЛрджрди",
  "access": "рдкреНрд░рд╡реЗрд╢",
  "protected": "рд╕реБрд░рдХреНрд╖рд┐рдд",
  "hashing": "рд╣реИрд╢рд┐рдВрдЧ",
  "salt": "рд╕реЙрд▓реНрдЯ",
  "key": "рдХреБрдВрдЬреА",
  "token": "рдЯреЛрдХрди",
  "credential": "рдкреНрд░рдорд╛рдг рдкрддреНрд░",
  "privacy": "рдЧреЛрдкрдиреАрдпрддрд╛",
  "secure": "рд╕реБрд░рдХреНрд╖рд┐рдд",
  "hacker": "рд╣реИрдХрд░",
  "brute force": "рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕",
  "phishing": "рдлрд┐рд╢рд┐рдВрдЧ",
  "malware": "рдореИрд▓рд╡реЗрдпрд░",
  "two-factor authentication": "рджреНрд╡рд┐-рдХрд╛рд░рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг",
  "forgot password": "рдкрд╛рд╕рд╡рд░реНрдб рднреВрд▓ рдЧрдП",
  "reset password": "рдкрд╛рд╕рд╡рд░реНрдб рд░реАрд╕реЗрдЯ рдХрд░реЗрдВ",
  "password strength": "рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдордЬрдмреВрддреА",
  "strong password": "рдордЬрдмреВрдд рдкрд╛рд╕рд╡рд░реНрдб",
  "weak password": "рдХрдордЬреЛрд░ рдкрд╛рд╕рд╡рд░реНрдб",
  "password manager": "рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдмрдВрдзрдХ",
  "OTP": "рдУрдЯреАрдкреА (рд╡рди рдЯрд╛рдЗрдо рдкрд╛рд╕рд╡рд░реНрдб)",
  "passcode": "рдкрд╛рд╕рдХреЛрдб",
  "PIN": "рдкрд┐рди (рд╡реНрдпрдХреНрддрд┐рдЧрдд рдкрд╣рдЪрд╛рди рд╕рдВрдЦреНрдпрд╛)",
  "biometric authentication": "рдмрд╛рдпреЛрдореЗрдЯреНрд░рд┐рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг",
  "fingerprint": "рдлрд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯ",
  "face recognition": "рдЪреЗрд╣рд░рд╛ рдкрд╣рдЪрд╛рди",
  "security question": "рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рд╢реНрди",
  "password policy": "рдкрд╛рд╕рд╡рд░реНрдб рдиреАрддрд┐",
  "password recovery": "рдкрд╛рд╕рд╡рд░реНрдб рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддрд┐",
  "password expiration": "рдкрд╛рд╕рд╡рд░реНрдб рд╕рдорд╛рдкреНрддрд┐",
  "data breach": "рдбреЗрдЯрд╛ рдЙрд▓реНрд▓рдВрдШрди",
  "password generator": "рдкрд╛рд╕рд╡рд░реНрдб рдЬрдирд░реЗрдЯрд░",
  "dictionary attack": "рдбрд┐рдХреНрд╢рдирд░реА рдЕрдЯреИрдХ",
  "rainbow table attack": "рд░реЗрдирдмреЛ рдЯреЗрдмрд▓ рдЕрдЯреИрдХ",
  "multi-factor authentication": "рдмрд╣реБ-рдХрд╛рд░рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг",
  "session timeout": "рд╕рддреНрд░ рд╕рдорд╛рдкреНрддрд┐",
  "captcha": "рдХреИрдкреНрдЪрд╛",
  "lockout": "рд▓реЙрдХрдЖрдЙрдЯ",
  "recovery email": "рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддрд┐ рдИрдореЗрд▓",
  "backup code": "рдмреИрдХрдЕрдк рдХреЛрдб",
  "security breach": "рд╕реБрд░рдХреНрд╖рд╛ рдЙрд▓реНрд▓рдВрдШрди",
  "firewall": "рдлрд╝рд╛рдпрд░рд╡реЙрд▓",
  "cyber attack": "рд╕рд╛рдЗрдмрд░ рд╣рдорд▓рд╛",
  "password hint": "рдкрд╛рд╕рд╡рд░реНрдб рд╕рдВрдХреЗрдд",
  "keystroke logging": "рдХреАрд╕реНрдЯреНрд░реЛрдХ рд▓реЙрдЧрд┐рдВрдЧ",
  "session hijacking": "рд╕рддреНрд░ рдЕрдкрд╣рд░рдг",
  "zero trust security": "рдЬрд╝реАрд░реЛ рдЯреНрд░рд╕реНрдЯ рд╕реБрд░рдХреНрд╖рд╛",
  "hash function": "рд╣реИрд╢ рдлрд╝рдВрдХреНрд╢рди",
  "MD5": "рдПрдордбреА5",
  "SHA": "рдПрд╕рдПрдЪрдП (рд╕рд┐рдХреНрдпреЛрд░ рд╣реИрд╢ рдПрд▓реНрдЧреЛрд░рд┐рджрдо)",
  "password": "рдкрд╛рд╕рд╡рд░реНрдб",
  "username": "рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо",
  "login": "рд▓реЙрдЧрд┐рди",
  "logout": "рд▓реЙрдЧрдЖрдЙрдЯ",
  "register": "рдкрдВрдЬреАрдХрд░рдг",
  "forgot password": "рдкрд╛рд╕рд╡рд░реНрдб рднреВрд▓ рдЧрдП",
  "reset password": "рдкрд╛рд╕рд╡рд░реНрдб рд░реАрд╕реЗрдЯ рдХрд░реЗрдВ",
  "change password": "рдкрд╛рд╕рд╡рд░реНрдб рдмрджрд▓реЗрдВ",
  "password strength": "рдкрд╛рд╕рд╡рд░реНрдб рдХреА рдордЬрдмреВрддреА",
  "strong password": "рдордЬрдмреВрдд рдкрд╛рд╕рд╡рд░реНрдб",
  "weak password": "рдХрдордЬреЛрд░ рдкрд╛рд╕рд╡рд░реНрдб",
  "password match": "рдкрд╛рд╕рд╡рд░реНрдб рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИ",
  "password mismatch": "рдкрд╛рд╕рд╡рд░реНрдб рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддрд╛",
  "show password": "рдкрд╛рд╕рд╡рд░реНрдб рджрд┐рдЦрд╛рдПрдВ",
  "hide password": "рдкрд╛рд╕рд╡рд░реНрдб рдЫреБрдкрд╛рдПрдВ",
  "confirm password": "рдкрд╛рд╕рд╡рд░реНрдб рдкреБрд╖реНрдЯрд┐ рдХрд░реЗрдВ",
  "security question": "рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рд╢реНрди",
  "OTP": "рдУрдЯреАрдкреА (рд╡рди рдЯрд╛рдЗрдо рдкрд╛рд╕рд╡рд░реНрдб)",
  "authentication": "рдкреНрд░рдорд╛рдгреАрдХрд░рдг",
  "two-factor authentication": "рджреНрд╡рд┐-рдХрд╛рд░рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг",
  "auto-fill password": "рд╕реНрд╡рддрдГ рдкрд╛рд╕рд╡рд░реНрдб рднрд░реЗрдВ",
  "password manager": "рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рдмрдВрдзрдХ",
  "save password": "рдкрд╛рд╕рд╡рд░реНрдб рд╕рд╣реЗрдЬреЗрдВ",
  "password encryption": "рдкрд╛рд╕рд╡рд░реНрдб рдПрдирдХреНрд░рд┐рдкреНрд╢рди",
  "password decryption": "рдкрд╛рд╕рд╡рд░реНрдб рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди",
  "password policy": "рдкрд╛рд╕рд╡рд░реНрдб рдиреАрддрд┐",
  "password expiry": "рдкрд╛рд╕рд╡рд░реНрдб рд╕рдорд╛рдкреНрддрд┐",
  "password update": "рдкрд╛рд╕рд╡рд░реНрдб рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ",
  "secure login": "рд╕реБрд░рдХреНрд╖рд┐рдд рд▓реЙрдЧрд┐рди",
  "session timeout": "рд╕рддреНрд░ рд╕рдорд╛рдкреНрддрд┐",
  "lock screen": "рд▓реЙрдХ рд╕реНрдХреНрд░реАрди",
  "hello": "рдирдорд╕реНрддреЗ",
  "hi": "рдирдорд╕реНрддреЗ",
  "how are you": "рдЖрдк рдХреИрд╕реЗ рд╣реИрдВ?",
  "I am fine": "рдореИрдВ рдареАрдХ рд╣реВрдБ",
  "what is your name": "рдЖрдкрдХрд╛ рдирд╛рдо рдХреНрдпрд╛ рд╣реИ?",
  "my name is": "рдореЗрд░рд╛ рдирд╛рдо рд╣реИ",
  "nice to meet you": "рдЖрдкрд╕реЗ рдорд┐рд▓рдХрд░ рдЦреБрд╢реА рд╣реБрдИ",
  "good morning": "рд╕реБрдкреНрд░рднрд╛рдд",
  "good night": "рд╢реБрдн рд░рд╛рддреНрд░рд┐",
  "goodbye": "рдЕрд▓рд╡рд┐рджрд╛",
  "see you later": "рдлрд┐рд░ рдорд┐рд▓реЗрдВрдЧреЗ",
  "thank you": "рдзрдиреНрдпрд╡рд╛рдж",
  "you're welcome": "рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ",
  "please": "рдХреГрдкрдпрд╛",
  "sorry": "рдорд╛рдлрд╝ рдХреАрдЬрд┐рдП",
  "excuse me": "рдХреНрд╖рдорд╛ рдХрд░реЗрдВ",
  "yes": "рд╣рд╛рдБ",
  "no": "рдирд╣реАрдВ",
  "maybe": "рд╢рд╛рдпрдж",
  "what are you doing": "рдЖрдк рдХреНрдпрд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ?",
  "where are you from": "рдЖрдк рдХрд╣рд╛рдБ рд╕реЗ рд╣реИрдВ?",
  "I am from": "рдореИрдВ ... рд╕реЗ рд╣реВрдБ",
  "how old are you": "рдЖрдкрдХреА рдЙрдореНрд░ рдХреНрдпрд╛ рд╣реИ?",
  "I don't know": "рдореБрдЭреЗ рдирд╣реАрдВ рдкрддрд╛",
  "can you help me": "рдХреНрдпрд╛ рдЖрдк рдореЗрд░реА рдорджрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ?",
  "I understand": "рдореИрдВ рд╕рдордЭ рдЧрдпрд╛",
  "I don't understand": "рдореБрдЭреЗ рд╕рдордЭ рдирд╣реАрдВ рдЖрдпрд╛",
  "let's go": "рдЪрд▓реЛ рдЪрд▓рддреЗ рд╣реИрдВ",
  "wait a moment": "рдПрдХ рдХреНрд╖рдг рд░реБрдХреЛ",
  "congratulations": "рдмрдзрд╛рдИ рд╣реЛ",
  "best of luck": "рд╢реБрднрдХрд╛рдордирд╛рдПрдБ",
  "take care": "рдЕрдкрдирд╛ рдзреНрдпрд╛рди рд░рдЦрдирд╛",
  "what's up": "рдХреНрдпрд╛ рдЪрд▓ рд░рд╣рд╛ рд╣реИ?",
  "nothing much": "рдХреБрдЫ рдЦрд╛рд╕ рдирд╣реАрдВ",
  "how was your day": "рдЖрдкрдХрд╛ рджрд┐рди рдХреИрд╕рд╛ рд░рд╣рд╛?",
  "it was good": "рдЕрдЪреНрдЫрд╛ рдерд╛",
  "it was bad": "рдЦрд░рд╛рдм рдерд╛",
  "what do you like": "рдЖрдкрдХреЛ рдХреНрдпрд╛ рдкрд╕рдВрдж рд╣реИ?",
  "I like it": "рдореБрдЭреЗ рдпрд╣ рдкрд╕рдВрдж рд╣реИ",
  "I don't like it": "рдореБрдЭреЗ рдпрд╣ рдкрд╕рдВрдж рдирд╣реАрдВ рд╣реИ",
  "do you speak Hindi": "рдХреНрдпрд╛ рдЖрдк рд╣рд┐рдВрджреА рдмреЛрд▓рддреЗ рд╣реИрдВ?",
  "I speak a little Hindi": "рдореИрдВ рдереЛрдбрд╝реА рд╣рд┐рдВрджреА рдмреЛрд▓рддрд╛ рд╣реВрдБ",
  "what is happening": "рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИ?",
  "where are you going": "рдЖрдк рдХрд╣рд╛рдБ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ?",
  "I am going home": "рдореИрдВ рдШрд░ рдЬрд╛ рд░рд╣рд╛ рд╣реВрдБ",
  "I am busy": "рдореИрдВ рд╡реНрдпрд╕реНрдд рд╣реВрдБ",
  "I am free": "рдореИрдВ рдЦрд╛рд▓реА рд╣реВрдБ",
  "letтАЩs meet": "рдЪрд▓реЛ рдорд┐рд▓рддреЗ рд╣реИрдВ",
  "call me later": "рдореБрдЭреЗ рдмрд╛рдж рдореЗрдВ рдХреЙрд▓ рдХрд░рдирд╛",
  "I will call you": "рдореИрдВ рдЖрдкрдХреЛ рдХреЙрд▓ рдХрд░реВрдВрдЧрд╛",
  "do you need help": "рдХреНрдпрд╛ рдЖрдкрдХреЛ рдорджрдж рдЪрд╛рд╣рд┐рдП?",
  "I am hungry": "рдореБрдЭреЗ рднреВрдЦ рд▓рдЧреА рд╣реИ",
  "I am thirsty": "рдореБрдЭреЗ рдкреНрдпрд╛рд╕ рд▓рдЧреА рд╣реИ",
  "where is the washroom": "рд╡реЙрд╢рд░реВрдо рдХрд╣рд╛рдБ рд╣реИ?",
  "what time is it": "рдХрд┐рддрдиреЗ рдмрдЬреЗ рд╣реИрдВ?",
  "I am tired": "рдореИрдВ рдердХ рдЧрдпрд╛ рд╣реВрдБ",
  "what do you think": "рдЖрдкрдХрд╛ рдХреНрдпрд╛ рд╡рд┐рдЪрд╛рд░ рд╣реИ?",
  "I agree": "рдореИрдВ рд╕рд╣рдордд рд╣реВрдБ",
  "I disagree": "рдореИрдВ рдЕрд╕рд╣рдордд рд╣реВрдБ",
  "it's okay": "рдХреЛрдИ рдмрд╛рдд рдирд╣реАрдВ",
  "don't worry": "рдЪрд┐рдВрддрд╛ рдордд рдХрд░реЛ",
  "be careful": "рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ",
  "hurry up": "рдЬрд▓реНрджреА рдХрд░реЛ",
  "slow down": "рдзреАрд░реЗ рдЪрд▓реЛ",
  "letтАЩs go out": "рдЪрд▓реЛ рдмрд╛рд╣рд░ рдЪрд▓рддреЗ рд╣реИрдВ",
  "have fun": "рдордЬрд╝реЗ рдХрд░реЛ",
  "enjoy your day": "рдЕрдкрдиреЗ рджрд┐рди рдХрд╛ рдЖрдирдВрдж рд▓реЛ",
  "how is everything": "рд╕рдм рдХреИрд╕рд╛ рдЪрд▓ рд░рд╣рд╛ рд╣реИ?",
  "everything is fine": "рд╕рдм рдареАрдХ рд╣реИ",
  "long time no see": "рдмрд╣реБрдд рд╕рдордп рдмрд╛рдж рдорд┐рд▓реЗ",
  "what are you thinking": "рдЖрдк рдХреНрдпрд╛ рд╕реЛрдЪ рд░рд╣реЗ рд╣реИрдВ?",
  "just kidding": "рдореИрдВ рдордЬрд╛рдХ рдХрд░ рд░рд╣рд╛ рд╣реВрдБ",
  "I am serious": "рдореИрдВ рдЧрдВрднреАрд░ рд╣реВрдБ",
  "really": "рд╕рдЪ рдореЗрдВ?",
  "of course": "рдмрд┐рд▓реНрдХреБрд▓",
  "that's great": "рдпрд╣ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд╣реИ",
  "that's terrible": "рдпрд╣ рдмрд╣реБрдд рдмреБрд░рд╛ рд╣реИ",
  "don't be sad": "рдЙрджрд╛рд╕ рдордд рд╣реЛ",
  "cheer up": "рдЦреБрд╢ рд╣реЛ рдЬрд╛рдУ",
  "what's new": "рдирдпрд╛ рдХреНрдпрд╛ рд╣реИ?",
  "same as always": "рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣",
  "I have no idea": "рдореБрдЭреЗ рдХреЛрдИ рдЕрдВрджрд╛рдЬрд╛ рдирд╣реАрдВ",
  "let me think": "рдореБрдЭреЗ рд╕реЛрдЪрдиреЗ рджреЛ",
  "tell me more": "рдореБрдЭреЗ рдФрд░ рдмрддрд╛рдУ",
  "that's interesting": "рдпрд╣ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ",
  "I am bored": "рдореИрдВ рдмреЛрд░ рд╣реЛ рд░рд╣рд╛ рд╣реВрдБ",
  "I am excited": "рдореИрдВ рдЙрддреНрд╕рд╛рд╣рд┐рдд рд╣реВрдБ",
  "calm down": "рд╢рд╛рдВрдд рд╣реЛ рдЬрд╛рдУ",
  "don't panic": "рдШрдмрд░рд╛рдУ рдордд",
  "take it easy": "рдЖрд░рд╛рдо рд╕реЗ рд▓реЛ",
  "it doesn't matter": "рдХреЛрдИ рдлрд░реНрдХ рдирд╣реАрдВ рдкрдбрд╝рддрд╛",
  "never mind": "рдХреЛрдИ рдмрд╛рдд рдирд╣реАрдВ",
  "I hope so": "рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ",
  "what a surprise": "рдХреНрдпрд╛ рд╕рд░рдкреНрд░рд╛рдЗрдЬрд╝ рд╣реИ!",
  "I am proud of you": "рдореБрдЭреЗ рддреБрдо рдкрд░ рдЧрд░реНрд╡ рд╣реИ",
  "better luck next time": "рдЕрдЧрд▓реА рдмрд╛рд░ рдХрд┐рд╕реНрдордд рдЕрдЪреНрдЫреА рд╣реЛрдЧреА",
  "do your best": "рдЕрдкрдиреА рдкреВрд░реА рдХреЛрд╢рд┐рд╢ рдХрд░реЛ",
  "I trust you": "рдореБрдЭреЗ рддреБрдо рдкрд░ рднрд░реЛрд╕рд╛ рд╣реИ",
  "don't give up": "рд╣рд╛рд░ рдордд рдорд╛рдиреЛ",
  "I need some rest": "рдореБрдЭреЗ рдереЛрдбрд╝рд╛ рдЖрд░рд╛рдо рдЪрд╛рд╣рд┐рдП",
  "I will be right back": "рдореИрдВ рдЕрднреА рд╡рд╛рдкрд╕ рдЖрддрд╛ рд╣реВрдБ",
  "can we talk": "рдХреНрдпрд╛ рд╣рдо рдмрд╛рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ?",
  "give me a minute": "рдореБрдЭреЗ рдПрдХ рдорд┐рдирдЯ рджреЛ",
  "I am on my way": "рдореИрдВ рд░рд╛рд╕реНрддреЗ рдореЗрдВ рд╣реВрдБ",
  "stay strong": "рдордЬрдмреВрдд рдмрдиреЗ рд░рд╣реЛ"


};
    
    let sessions = JSON.parse(localStorage.getItem("chatSessions")) || [];
    let currentSessionId = localStorage.getItem("currentSessionId") || null;
    if (!currentSessionId || sessions.length === 0) {
      currentSessionId = "session-" + Date.now();
      let newSession = { id: currentSessionId, title: "New Chat", messages: [] };
      sessions.push(newSession);
      localStorage.setItem("chatSessions", JSON.stringify(sessions));
      localStorage.setItem("currentSessionId", currentSessionId);
    }
    
    let chatbotPersonality = "formal";  // рд╡реИрдХрд▓реНрдкрд┐рдХ: "informal"
    let user_context = {
      name: null,
      last_intent: null,
      conversation: []  // рдкреВрд░реЗ рдмрд╛рддрдЪреАрдд рдХрд╛ рд░рд┐рдХреЙрд░реНрдб
    };
    let darkMode = false;
    
    /******************************************************************
     * HELPER FUNCTIONS: рд╕реБрд░рдХреНрд╖рд╛, рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк, рдиреЙрд░реНрдорд▓рд╛рдЗрдЬреЗрд╢рди рдЖрджрд┐
     ******************************************************************/
    function escapeHTML(str) {
      return str.replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
    }
    
    function getTimestamp() {
      let now = new Date();
      return now.getHours().toString().padStart(2, "0") + ":" +
             now.getMinutes().toString().padStart(2, "0");
    }
    
    function normalizeText(text) {
      return text.split(" ").map(word => {
        let lw = word.toLowerCase();
        return synonyms[lw] ? synonyms[lw] : lw;
      }).join(" ");
    }
    
    function translateToHindi(text) {
      let lower = text.toLowerCase();
      if(lower.indexOf("my name is") !== -1) {
        return text.replace(/my name is/gi, "рдореЗрд░рд╛ рдирд╛рдо рд╣реИ");
      }
      return text;
    }
    
    /******************************************************************
     * SENTIMENT ANALYSIS FUNCTION
     ******************************************************************/
    const positiveWords = ["рдЕрдЪреНрдЫрд╛", "рдЦреБрд╢", "рдмрдврд╝рд┐рдпрд╛", "рд╢рд╛рдирджрд╛рд░", "рд╕реБрдиреНрджрд░"];
    const negativeWords = ["рдмреБрд░рд╛", "рджреБрдЦ", "рдЦрд░рд╛рдм", "рдЙрджрд╛рд╕", "рдирд╛рдкрд╕рдВрдж"];
    function analyzeSentiment(message) {
      let words = message.split(" ");
      let posCount = 0, negCount = 0;
      words.forEach(word => {
        let lw = word.toLowerCase();
        if (positiveWords.includes(lw)) posCount++;
        if (negativeWords.includes(lw)) negCount++;
      });
      if (posCount > negCount) return "positive";
      else if (negCount > posCount) return "negative";
      else return "neutral";
    }
    
    /******************************************************************
     * INTENT-BASED SYSTEM FUNCTIONS
     ******************************************************************/
    const intents = {
      greet: {
        keywords: ["рдирдорд╕реНрддреЗ", "рд╣рд╛рдп", "hello", "hi"],
        responses: {
          formal: ["{greeting_time}! рдХреИрд╕реЗ рд╣реЛ рдЖрдк?", "{greeting_time}! рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИред"],
          informal: ["{greeting_time} рджреЛрд╕реНрдд! рдХреНрдпрд╛ рд╣рд╛рд▓ рд╣реИ?", "{greeting_time}! рдХреИрд╕рд╛ рдЪрд▓ рд░рд╣рд╛ рд╣реИ?"]
        }
      },
      how_are_you: {
        keywords: ["рдХреИрд╕реЗ рд╣реЛ", "рдХреНрдпрд╛ рд╣рд╛рд▓ рд╣реИ", "how are you"],
        responses: {
          formal: ["рдореИрдВ рдареАрдХ рд╣реВрдБ, рдзрдиреНрдпрд╡рд╛рдж!", "рд╕рдм рдмрдврд╝рд┐рдпрд╛ рд╣реИред"],
          informal: ["рдореИрдВ рдорд╕реНрдд рд╣реВрдБ!", "рдмрд┐рд▓рдХреБрд▓ рдЯреЙрдк, рд╢реБрдХреНрд░рд┐рдпрд╛!"]
        }
      },
      goodbye: {
        keywords: ["рдЕрд▓рд╡рд┐рджрд╛", "рдмрд╛рдп", "рдлрд┐рд░ рдорд┐рд▓реЗрдВрдЧреЗ"],
        responses: {
          formal: ["рдЕрд▓рд╡рд┐рджрд╛!", "рдлрд┐рд░ рдорд┐рд▓реЗрдВрдЧреЗ!", "рдЖрдкрдХрд╛ рджрд┐рди рд╢реБрдн рд╣реЛред"],
          informal: ["рдмрд╛рдп рджреЛрд╕реНрдд!", "рдЪрд▓реЛ рдлрд┐рд░, рдорд┐рд▓рддреЗ рд╣реИрдВ!", "рдЕрд▓рд╡рд┐рджрд╛, рдлрд┐рд░ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗред"]
        }
      },
      dhaval: {
       keywords: ["Gameti", "Narayan", "best"]
          ,
        response: {
          formal: ["GamrtiDhaval", "visva vijeta","Gametin"],
          informal: ["Sale kutte", "bhosadike", "baharja"]
        }
      },
      thanks: {
        keywords: ["рдзрдиреНрдпрд╡рд╛рдж", "рдереИрдВрдХреНрд╕", "рд╢реБрдХреНрд░рд┐рдпрд╛"],
        responses: {
          formal: ["рдЖрдкрдХрд╛ рд╕реНрд╡рд╛рдЧрдд рд╣реИ!", "рдХреЛрдИ рдмрд╛рдд рдирд╣реАрдВ!", "рдореЗрд░рд╛ рд╕реМрднрд╛рдЧреНрдп рд╣реИ!"],
          informal: ["рдХреЛрдИ рдмрд╛рдд рдирд╣реАрдВ рдпрд╛рд░!", "рдмрд┐рд▓рдХреБрд▓!", "рдЦреБрд╢реА рд╣реБрдИ!"]
        }
      }
    };
    
    function get_greeting_time() {
      const hour = new Date().getHours();
      if (hour >= 5 && hour < 12) return "рд╕реБрдкреНрд░рднрд╛рдд";
      else if (hour >= 12 && hour < 17) return "рдирдорд╕реНрдХрд╛рд░";
      else if (hour >= 17 && hour < 21) return "рд╢реБрдн рд╕рдВрдзреНрдпрд╛";
      else return "рд╢реБрдн рд░рд╛рддреНрд░рд┐";
    }
    
    function levenshtein(a, b) {
      const matrix = [];
      for (let i = 0; i <= b.length; i++) { matrix[i] = [i]; }
      for (let j = 0; j <= a.length; j++) { matrix[0][j] = j; }
      for (let i = 1; i <= b.length; i++) {
        for (let j = 1; j <= a.length; j++) {
          if (b.charAt(i - 1) === a.charAt(j - 1))
            matrix[i][j] = matrix[i - 1][j - 1];
          else
            matrix[i][j] = Math.min(
              matrix[i - 1][j - 1] + 1,
              matrix[i][j - 1] + 1,
              matrix[i - 1][j] + 1
            );
        }
      }
      return matrix[b.length][a.length];
    }
    
    function similarity(s1, s2) {
      s1 = s1.toLowerCase();
      s2 = s2.toLowerCase();
      const distance = levenshtein(s1, s2);
      const maxLen = Math.max(s1.length, s2.length);
      if (maxLen === 0) return 1;
      return 1 - distance / maxLen;
    }
    
    function detect_intent(user_input) {
      let best_intent = null;
      let best_score = 0;
      for (const intent in intents) {
        for (const keyword of intents[intent].keywords) {
          let score = similarity(user_input, keyword);
          if (score > best_score) {
            best_score = score;
            best_intent = intent;
          }
        }
      }
      return (best_score >= 0.5) ? best_intent : null;
    }
    
    function generate_response(intent) {
      let responses = intents[intent].responses[chatbotPersonality] ||
                      intents[intent].responses.formal;
      let response = responses[Math.floor(Math.random() * responses.length)];
      if (intent === "greet") {
        const greetingTime = get_greeting_time();
        response = response.replace("{greeting_time}", greetingTime);
      }
      return response;
    }
    
    /******************************************************************
     * ADVANCED COMMANDS & CONTEXT MANAGEMENT
     ******************************************************************/
    function get_response(user_input) {
      let trimmed = user_input.trim();
      if (trimmed === "help") {
        return "рдЙрдкрд▓рдмреНрдз рдХрдорд╛рдВрдбреНрд╕: 'help', 'settings, 'рдЪреЗрдВрдЬ рдкрд░реНрд╕рдиреИрд▓рд┐рдЯреА', 'Show History', 'рдпреВрдЬрд╝рд░ рдкреНрд░реЛрдлрд╛рдЗрд▓', 'рд╕рдВрджрд░реНрдн рд╕рд╛рдлрд╝ рдХрд░реЛ' (рдХрдиреНрд╡рд░реНрд╕реЗрд╢рди рд░реАрд╕реЗрдЯ), 'рдЬреНрдЮрд╛рди рд╣рдЯрд╛рдУ <рдкреНрд░рд╢реНрди>', 'рдЬреНрдЮрд╛рди рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЛ <рдкреНрд░рд╢реНрди>', 'рд╕рд╛рд░рд╛рдВрд╢ рдмрддрд╛рдУ', 'рдордЬрд╛рдХ рд╕реБрдирд╛рдУ', 'рдЙрджреНрдзрд░рдг рдмрддрд╛рдУ', 'рдереАрдо рдмрджрд▓реЛ', 'рднрд╛рд╖рд╛ рдмрджрд▓реЛ'";
      }
      if (trimmed === "рд╕реЗрдЯрд┐рдВрдЧреНрд╕" || trimmed === "рдЪреЗрдВрдЬ рдкрд░реНрд╕рдиреИрд▓рд┐рдЯреА") {
        chatbotPersonality = (chatbotPersonality === "formal") ? "informal" : "formal";
        return `рдЪреИрдЯрдмреЙрдЯ рдЕрдм ${chatbotPersonality} рдкрд░реНрд╕рдиреИрд▓рд┐рдЯреА рдореЗрдВ рд╣реИред`;
      }
      if (trimmed === "Show History") {
        let history = getCurrentSession().messages.map(m => m.sender + ": " + m.text).join("\n");
        return "Chat History:\n" + history;
      }
      if (trimmed === "рдпреВрдЬрд╝рд░ рдкреНрд░реЛрдлрд╛рдЗрд▓") {
        return `рдпреВрдЬрд╝рд░ рдкреНрд░реЛрдлрд╛рдЗрд▓:\nрдирд╛рдо: ${user_context.name || "рдЕрдЬреНрдЮрд╛рдд"}\nрдкрд┐рдЫрд▓рд╛ рдЗрдВрдЯреЗрдВрдЯ: ${user_context.last_intent || "None"}`;
      }
      if (trimmed === "рд╕рдВрджрд░реНрдн рд╕рд╛рдлрд╝ рдХрд░реЛ" || trimmed === "рдХрдиреНрд╡рд░реНрд╕реЗрд╢рди рд░реАрд╕реЗрдЯ") {
        user_context.conversation = [];
        return "рдХрдиреНрд╡рд░реНрд╕реЗрд╢рди рдХрд╛ рд╕рдВрджрд░реНрдн рд╕рд╛рдлрд╝ рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред";
      }
      if (trimmed.startsWith("рдЬреНрдЮрд╛рди рд╣рдЯрд╛рдУ")) {
        let qToRemove = trimmed.replace("рдЬреНрдЮрд╛рди рд╣рдЯрд╛рдУ", "").trim();
        let idx = knowledgeBase.findIndex(entry => similarity(normalizeText(entry.question), normalizeText(qToRemove)) > 0.8);
        if (idx !== -1) {
          let removed = knowledgeBase.splice(idx, 1);
          return `рдЬреНрдЮрд╛рди рдПрдВрдЯреНрд░реА рд╣рдЯрд╛ рджреА рдЧрдИ: "${removed[0].question}"`;
        } else {
          return "рдХреНрд╖рдорд╛ рдХрд░реЗрдВ, рдРрд╕рд╛ рдХреЛрдИ рдЬреНрдЮрд╛рди рдирд╣реАрдВ рдорд┐рд▓рд╛ рдЬрд┐рд╕реЗ рд╣рдЯрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗред";
        }
      }
      if (trimmed.startsWith("рдЬреНрдЮрд╛рди рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЛ")) {
        let qToEdit = trimmed.replace("рдЬреНрдЮрд╛рди рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЛ", "").trim();
        let idx = knowledgeBase.findIndex(entry => similarity(normalizeText(entry.question), normalizeText(qToEdit)) > 0.8);
        if (idx !== -1) {
          editingKnowledgeEntry = { index: idx, question: knowledgeBase[idx].question };
          return `рдХреГрдкрдпрд╛ рдирдпрд╛ рдЙрддреНрддрд░ рджрд░реНрдЬ рдХрд░реЗрдВ, рдЬреЛ "${knowledgeBase[idx].question}" рдХреЗ рд▓рд┐рдП рд╕рдВрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред`;
        } else {
          return "рдХреНрд╖рдорд╛ рдХрд░реЗрдВ, рдРрд╕рд╛ рдХреЛрдИ рдЬреНрдЮрд╛рди рдирд╣реАрдВ рдорд┐рд▓рд╛ рдЬрд┐рд╕реЗ рд╕рдВрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред";
        }
      }
      if (trimmed === "рд╕рд╛рд░рд╛рдВрд╢ рдмрддрд╛рдУ") {
        let convo = user_context.conversation;
        if (convo.length === 0) {
          return "рдХрдиреНрд╡рд░реНрд╕реЗрд╢рди рдореЗрдВ рдЕрднреА рддрдХ рдХреЛрдИ рд╕рдВрджреЗрд╢ рдирд╣реАрдВ рд╣реИред";
        }
        let summary = "рд╣рд╛рд▓рд┐рдпрд╛ рдмрд╛рддрдЪреАрдд рдХрд╛ рд╕рд╛рд░рд╛рдВрд╢:\n";
        let recent = convo.slice(-5);
        recent.forEach(msg => {
          summary += `${msg.sender}: ${msg.text}\n`;
        });
        return summary;
      }
      if (trimmed === "рдордЬрд╛рдХ рд╕реБрдирд╛рдУ") {
        let joke = jokes[Math.floor(Math.random() * jokes.length)];
        return joke;
      }
      if (trimmed === "рдЙрджреНрдзрд░рдг рдмрддрд╛рдУ") {
        let quote = quotes[Math.floor(Math.random() * quotes.length)];
        return quote;
      }
      if (trimmed === "рдереАрдо рдмрджрд▓реЛ") {
        darkMode = !darkMode;
        if (darkMode) {
          document.body.style.backgroundColor = "#333";
          document.body.style.color = "#fff";
        } else {
          document.body.style.backgroundColor = "#f2f2f2";
          document.body.style.color = "#000";
        }
        return `рдереАрдо рдмрджрд▓ рджреА рдЧрдИ рд╣реИ: ${darkMode ? "рдбрд╛рд░реНрдХ рдореЛрдб" : "рд▓рд╛рдЗрдЯ рдореЛрдб"}`;
      }
      if (trimmed === "рднрд╛рд╖рд╛ рдмрджрд▓реЛ") {
        return "рдЕрднреА рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рд╣рд┐рдВрджреА рднрд╛рд╖рд╛ рдЙрдкрд▓рдмреНрдз рд╣реИред";
      }
      if (trimmed.toLowerCase().startsWith("рдореЗрд░рд╛ рдирд╛рдо рд╣реИ")) {
        let name = trimmed.substring("рдореЗрд░рд╛ рдирд╛рдо рд╣реИ".length).trim();
        user_context.name = name;
        return `рдЖрдкрдХрд╛ рдирд╛рдо ${name} рд╣реЛ рдЧрдпрд╛ рд╣реИред`;
      }
      let intent = detect_intent(trimmed);
      user_context.last_intent = intent;
      if (intent) {
        return generate_response(intent);
      }
      return null;
    }
    
    function extractLocationInfo(subject, sentence) {
      let words = sentence.split(" ");
      let index = words.findIndex(word => word.includes("рдмрд╕рд╛"));
      if (index > 0) {
        let locationWord = words[index-1];
        return subject + " " + locationWord + " рдмрд╕рд╛ рд╣реЗред";
      }
      return sentence;
    }
    
    function processMessage(message) {
      if (editingKnowledgeEntry !== null) {
        knowledgeBase[editingKnowledgeEntry.index].answer = message;
        showTypingIndicator(() => {
          appendMessageToChat("bot", "рдЬреНрдЮрд╛рди рдЕрдкрдбреЗрдЯ рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред");
        });
        editingKnowledgeEntry = null;
        return;
      }
      
      if (pendingQuestion !== null) {
        knowledgeBase.push({ question: pendingQuestion, answer: message });
        showTypingIndicator(() => {
          appendMessageToChat("bot", "рдзрдиреНрдпрд╡рд╛рдж! рдореИрдВрдиреЗ рдирдпрд╛ рдЬреНрдЮрд╛рди рд╕реАрдЦ рд▓рд┐рдпрд╛ рд╣реИред");
        });
        pendingQuestion = null;
        return;
      }
      
      const exitCommands = ["рдмрдВрдж рдХрд░реЛ", "рдареАрдХ рд╣реИ рдмрдВрдж рдХрд░реЛ", "рдмрд╛рдп"];
      if (exitCommands.includes(message.trim().toLowerCase())) {
        showTypingIndicator(() => {
          appendMessageToChat("bot", "рдлрд┐рд░ рдорд┐рд▓реЗрдВрдЧреЗ! ЁЯСЛ");
        });
        return;
      }
      
      let processedMessage = translateToHindi(message);
      processedMessage = normalizeText(processedMessage);
      let sentiment = analyzeSentiment(processedMessage);
      user_context.conversation.push({ sender: "user", text: processedMessage, time: getTimestamp() });
      
      let intent_response = get_response(processedMessage);
      if (intent_response !== null) {
        if (sentiment === "negative")
          intent_response = "рдореБрдЭреЗ рдЦреЗрдж рд╣реИ рдХрд┐ рдЖрдк рдЙрджрд╛рд╕ рд╣реИрдВред " + intent_response;
        showTypingIndicator(() => {
          appendMessageToChat("bot", intent_response);
          user_context.conversation.push({ sender: "bot", text: intent_response, time: getTimestamp() });
        });
        return;
      }
      
      if (processedMessage.indexOf("free fire") !== -1 || processedMessage.indexOf("freefire") !== -1) {
        let bestExtendedMatch = null;
        let bestExtendedScore = 0;
        extendedData.forEach(function(pair) {
          let normQuestion = normalizeText(pair.question);
          let score = similarity(processedMessage, normQuestion);
          if (score > bestExtendedScore) {
            bestExtendedScore = score;
            bestExtendedMatch = pair;
          }
        });
        if (bestExtendedMatch && bestExtendedScore >= 0.6) {
          showTypingIndicator(() => {
            appendMessageToChat("bot", bestExtendedMatch.answer);
            user_context.conversation.push({ sender: "bot", text: bestExtendedMatch.answer, time: getTimestamp() });
          });
          return;
        }
      }
      
      for (let subject in subjectData) {
        if (processedMessage.indexOf(subject) !== -1) {
          let content = subjectData[subject];
          let sentences = content.split(/\.|\?|!/);
          let bestSentence = "";
          let bestSentenceScore = 0;
          sentences.forEach(sentence => {
            let score = similarity(processedMessage, sentence);
            if (score > bestSentenceScore) {
              bestSentenceScore = score;
              bestSentence = sentence;
            }
          });
          if (bestSentence && bestSentenceScore >= 0.5) {
            if (processedMessage.includes("рдХрд╣рд╛") && processedMessage.includes("рдмрд╕рд╛")) {
              let response = extractLocationInfo(subject, bestSentence);
              showTypingIndicator(() => {
                appendMessageToChat("bot", response);
                user_context.conversation.push({ sender: "bot", text: response, time: getTimestamp() });
              });
              return;
            } else {
              showTypingIndicator(() => {
                appendMessageToChat("bot", bestSentence.trim());
                user_context.conversation.push({ sender: "bot", text: bestSentence.trim(), time: getTimestamp() });
              });
              return;
            }
          }
        }
      }
      
      let bestMatch = null;
      let bestScore = 0;
      knowledgeBase.forEach(function(pair) {
        let normQuestion = normalizeText(pair.question);
        let score = similarity(processedMessage, normQuestion);
        if (score > bestScore) {
          bestScore = score;
          bestMatch = pair;
        }
      });
      if (bestMatch && bestScore >= 0.6) {
        showTypingIndicator(() => {
          appendMessageToChat("bot", bestMatch.answer);
          user_context.conversation.push({ sender: "bot", text: bestMatch.answer, time: getTimestamp() });
        });
        return;
      }
      
      showTypingIndicator(() => {
        appendMessageToChat("bot", "рдореБрдЭреЗ рдЗрд╕рдХрд╛ рдЙрддреНрддрд░ рдирд╣реАрдВ рдкрддрд╛ред рдХреГрдкрдпрд╛ рд╕рд╣реА рдЙрддреНрддрд░ рджреЗрдВ:");
        user_context.conversation.push({ sender: "bot", text: "рдореБрдЭреЗ рдЗрд╕рдХрд╛ рдЙрддреНрддрд░ рдирд╣реАрдВ рдкрддрд╛ред рдХреГрдкрдпрд╛ рд╕рд╣реА рдЙрддреНрддрд░ рджреЗрдВ:", time: getTimestamp() });
      });
      pendingQuestion = message;
    }
    
    /******************************************************************
     * SESSION & CHAT WINDOW HELPER FUNCTIONS
     ******************************************************************/
    function saveSessions() {
      localStorage.setItem("chatSessions", JSON.stringify(sessions));
    }
    
    function getCurrentSession() {
      return sessions.find(session => session.id === currentSessionId);
    }
    
    function appendMessageToChat(sender, message) {
      const chatWindow = document.getElementById("chat-window");
      const messageDiv = document.createElement("div");
      messageDiv.className = "message " + sender;
      messageDiv.innerHTML = escapeHTML(message);
      const timeSpan = document.createElement("span");
      timeSpan.className = "timestamp";
      timeSpan.innerText = getTimestamp();
      messageDiv.appendChild(timeSpan);
      chatWindow.appendChild(messageDiv);
      chatWindow.scrollTop = chatWindow.scrollHeight;
      let currentSession = getCurrentSession();
      currentSession.messages.push({ sender: sender, text: message, time: getTimestamp() });
      saveSessions();
    }
    
    function loadCurrentSessionMessages() {
      const chatWindow = document.getElementById("chat-window");
      chatWindow.innerHTML = "";
      let currentSession = getCurrentSession();
      currentSession.messages.forEach(msg => {
        const messageDiv = document.createElement("div");
        messageDiv.className = "message " + msg.sender;
        messageDiv.innerHTML = escapeHTML(msg.text);
        const timeSpan = document.createElement("span");
        timeSpan.className = "timestamp";
        timeSpan.innerText = msg.time;
        messageDiv.appendChild(timeSpan);
        chatWindow.appendChild(messageDiv);
      });
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }
    
    function renderSessionList() {
      const sessionListDiv = document.getElementById("session-list");
      sessionListDiv.innerHTML = "";
      sessions.forEach(session => {
        const sessionDiv = document.createElement("div");
        sessionDiv.className = "session-item" + (session.id === currentSessionId ? " active" : "");
        sessionDiv.innerText = session.title;
        sessionDiv.addEventListener("click", () => {
          currentSessionId = session.id;
          localStorage.setItem("currentSessionId", currentSessionId);
          updateSessionTitle();
          loadCurrentSessionMessages();
          renderSessionList();
        });
        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-session";
        deleteBtn.innerText = "├Ч";
        deleteBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          if (confirm("рдХреНрдпрд╛ рдЖрдк рдЗрд╕ рдЪреИрдЯ рд╕рддреНрд░ рдХреЛ рд╣рдЯрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?")) {
            sessions = sessions.filter(s => s.id !== session.id);
            if (currentSessionId === session.id) {
              if (sessions.length > 0) {
                currentSessionId = sessions[0].id;
                localStorage.setItem("currentSessionId", currentSessionId);
              } else {
                currentSessionId = "session-" + Date.now();
                sessions.push({ id: currentSessionId, title: "New Chat", messages: [] });
                localStorage.setItem("currentSessionId", currentSessionId);
              }
            }
            saveSessions();
            renderSessionList();
            loadCurrentSessionMessages();
            updateSessionTitle();
          }
        });
        sessionDiv.appendChild(deleteBtn);
        sessionListDiv.appendChild(sessionDiv);
      });
    }
    
    function updateSessionTitle() {
      document.getElementById("session-title").innerText = getCurrentSession().title;
    }
    
    function showTypingIndicator(callback) {
      const indicator = document.getElementById("typing-indicator");
      indicator.style.display = "block";
      setTimeout(() => {
        indicator.style.display = "none";
        callback();
      }, 1000);
    }
    
    /******************************************************************
     * EVENT HANDLERS
     ******************************************************************/
    document.getElementById("send-button").addEventListener("click", () => {
      let userInput = document.getElementById("user-input").value.trim();
      if (userInput === "") return;
      appendMessageToChat("user", userInput);
      processMessage(userInput);
      document.getElementById("user-input").value = "";
    });
    
    document.getElementById("user-input").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        document.getElementById("send-button").click();
      }
    });
    
    document.getElementById("clear-chat-btn").addEventListener("click", () => {
      if (confirm("рдХреНрдпрд╛ рдЖрдк рд╕рд╛рд░рд╛ рдЪреИрдЯ рдЗрддрд┐рд╣рд╛рд╕ рд╣рдЯрд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?")) {
        let currentSession = getCurrentSession();
        currentSession.messages = [];
        saveSessions();
        loadCurrentSessionMessages();
      }
    });
    
    document.getElementById("new-session-btn").addEventListener("click", () => {
      currentSessionId = "session-" + Date.now();
      let newSession = { id: currentSessionId, title: "New Chat", messages: [] };
      sessions.push(newSession);
      localStorage.setItem("currentSessionId", currentSessionId);
      saveSessions();
      renderSessionList();
      loadCurrentSessionMessages();
      updateSessionTitle();
    });
    
    // JSON рдбреЗрдЯрд╛ рд▓реЛрдб рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рдЗрдирд┐рд╢рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░реЗрдВ
    loadData().then(() => {
      renderSessionList();
      loadCurrentSessionMessages();
      updateSessionTitle();
      if (getCurrentSession().messages.length === 0) {
        appendMessageToChat("bot", "рдирдорд╕реНрддреЗ! рдореИрдВ рдЖрдкрдХреА рдХреИрд╕реЗ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБ?");
      }
    });
  </script>
</body>
</html>